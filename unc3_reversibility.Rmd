---
title: "unc3_reversibility"
author: "Troy McDiarmid"
date: "31/05/2020"
output: html_document
---


```{r setup, include=FALSE}
##Load in them libraries
library(tidyverse)
library(scales)
library(broom)

```





Analysis for L4 recovery





```{r setup, include=FALSE}
##Bash loop to call choreography to output reversals from each tracker plate data file generated by the tracker

for folder in $( ls ); do java -jar /Users/troymcdiarmid/Desktop/Chore.jar --segment --shadowless --pixelsize 0.027 --minimum-move-body 2 --minimum-time 20 --output width,length,morphwidth,curve,area,midline,pathlen,bias,dir,angular,aspect,kink,crab,speed --plugin Reoutline::despike --plugin Respine --plugin MeasureReversal::tap::dt=1::collect=0.5 $folder; done

##Bash argument to grep all .trv choreography output files into a summary of reversals
grep -H '[.]*' $(find . -name '*.rev') > data.srev
cd ../..
```


```{r}
##Baseline N2 vs nlg-1::AID::GFP test

##Read in summary of reversal data file (data.srev) 

setwd("/Volumes/SAMWISE/Troy/reversibility/unc_3/N2_unc3_AID_0120_2019/data")
cleanrawsrev <- read_table2("data.srev", col_names = c("plate_id", "already_rev", "not_rev", "rev", "rev_dist", "dist_sd", "dist_sem", "dist_0_quart", "dist_1st_quart", "dist_2nd_quart", "dist_3rd_quart", "dsit_100th_percentile", "rev_dur", "dur_sd", "dur_sem", "dur_0_quart", "dur_1st_quart", "dur_2nd_quart", "dur_3rd_quart", "dur_100th_percentile"))
cleanrawsrev <- cleanrawsrev %>% 
  separate(plate_id, into = c("garbage", "plate_id", "genotype"), sep ="/") %>%
  separate(genotype, into = c("genotype", "time"), sep = ":")  %>% 
  separate(genotype, into = c("genotype", "growth_conditions"), sep = "_") %>% 
  select(genotype:dur_100th_percentile)

##Optional Code to rename your factors

cleanrawsrev$genotype <- recode(cleanrawsrev$genotype, `N2` = "Wild-type (N2)")

##Make time numeric and round time 

cleanrawsrev <- cleanrawsrev %>% mutate(time = as.numeric(time)) %>% 
  mutate(time = round(time, digits = 0)) 

##Calculate reversal probability

cleanrawsrev <- cleanrawsrev %>% 
  mutate(rev_prob = rev / (not_rev + rev)) 

##optional code to remove any bad observtions

cleanrawsrev <- cleanrawsrev %>% 
  filter(!(rev_dist == "0")) 
cleanrawsrev <- cleanrawsrev %>% 
  filter(!(time == "659")) 

##Calculate reversal speed 

cleanrawsrev <- cleanrawsrev %>%
  mutate(rev_speed = rev_dist / rev_dur) 

##Reorder factors

cleanrawsrev$genotype <- factor(cleanrawsrev$genotype,
    levels = c('OH13988N', 'OH13988C', 'OH13988A', 'OH13988D', ordered = TRUE))

##Mean rev data

mean_cleanrawsrev <- cleanrawsrev %>% 
  group_by(genotype, time) %>% 
  summarize_all(mean) 

##Add stim number NOTE: this must be changed to fit your experiment parameters 

mean_cleanrawsrev$stimulus_num <- rep(1:31, times = 4) 

##SD calcs

prob_SD <- cleanrawsrev %>% 
  group_by(genotype, time) %>% 
  summarise(prob_sd = sd(rev_prob))
dur_SD <- cleanrawsrev %>% 
  group_by(genotype, time) %>% 
  summarise(dur_sd = sd(rev_dur))
speed_SD <- cleanrawsrev %>% 
  group_by(genotype, time) %>% 
  summarise(speed_sd = sd(rev_speed))
dist_SD <- cleanrawsrev %>% 
  group_by(genotype, time) %>% 
  summarise(dist_sd = sd(rev_dist))

##SEM calcs

prob_SEM <- cleanrawsrev %>% 
  group_by(genotype, time) %>% 
  summarise(prob_sem = sd(rev_prob)/sqrt(length(rev_prob)))
dur_SEM <- cleanrawsrev %>% 
  group_by(genotype, time) %>% 
  summarise(dur_sem = sd(rev_dur)/sqrt(length(rev_dur)))
dist_SEM <- cleanrawsrev %>% 
  group_by(genotype, time) %>% 
  summarise(dist_sem = sd(rev_dist)/sqrt(length(rev_dist)))
speed_SEM <- cleanrawsrev %>% 
  group_by(genotype, time) %>% 
  summarise(speed_sem = sd(rev_speed)/sqrt(length(rev_speed)))

```


```{r}
##Habituation unc-3::AID::GFP continous degradation vs. non-treated

mean_cleanrawsrev_filt <- mean_cleanrawsrev %>% 
  filter(genotype %in% c("OH13988N", "OH13988C"))
prob_SEM_filt <- prob_SEM %>% 
  filter(genotype %in% c("OH13988N", "OH13988C"))
ggplot(mean_cleanrawsrev_filt, aes(stimulus_num, rev_prob, colour = genotype)) +
  theme_classic() + 
  geom_line(size = 1) + 
  geom_errorbar(aes(ymin=rev_prob-prob_SEM_filt$prob_sem, ymax=rev_prob+prob_SEM_filt$prob_sem), width = 0, size = 1) +
  scale_y_continuous(expand = c(0,0),
                     limits = c(0,1.00)) +
  geom_point(aes(shape=genotype), size = 4.25, fill = "white", stroke = 1.25) +
  scale_shape_manual(values=c(16,16,16)) +
  scale_size_manual(values=c(4.25,4.25,4.25)) +
  scale_colour_manual(values = c("black", "dodgerblue2", "#EDBD44", "gray39")) +
  labs(title = "", x = "Stimulus number", y = "Reversal probability") +
  theme(axis.line = element_line(colour = 'black', size = 2.25)) +
  theme(axis.ticks = element_line(colour = "black", size = 2.25)) +
  theme(axis.ticks.length= unit(.25, "cm")) +
  theme(axis.text = element_text(family="Arial", colour = "black", size = 30)) +
  theme(axis.title.x = element_text(family="Arial", colour = "black", size = 30)) +
  theme(axis.title.y = element_text(family="Arial", colour = "black", size = 30)) +
  theme(legend.position="none") +
  theme(plot.title = element_text(face = "bold", hjust = 0.5)) 
  ggsave("unc3_L4_AID_C_prob.jpeg", width = 7, height = 6, path = "/Users/troymcdiarmid/Documents/Reversibility_materials/Figures/unc3/L4_recovery/habituation")
  
#Plot of duration habituation
  
mean_cleanrawsrev_filt <- mean_cleanrawsrev %>% 
  filter(genotype %in% c("OH13988N", "OH13988C"))
dur_SEM_filt <- dur_SEM %>% 
  filter(genotype %in% c("OH13988N", "OH13988C"))
ggplot(mean_cleanrawsrev_filt, aes(stimulus_num, rev_dur, colour = genotype)) + 
  geom_line(size = 1) +
  theme_classic() + 
  geom_errorbar(aes(ymin=rev_dur-dur_SEM_filt$dur_sem, ymax=rev_dur+dur_SEM_filt$dur_sem), width = 0, size = 1) +
  scale_y_continuous(expand = c(0,0),
                     limits = c(0,4)) +
  geom_point(aes(shape=genotype), size = 4.25, fill = "white", stroke = 1.25) +
  scale_shape_manual(values=c(16,16,16)) +
  scale_size_manual(values=c(4.25,4.25,4.25)) +
  scale_color_manual(values=c("black", "dodgerblue2", "#EDBD44", "gray39")) +
  labs(title = "", x = "Stimulus number", y = "Reversal duration (S)") +
  theme(axis.line = element_line(colour = 'black', size = 2.25)) +
  theme(axis.ticks = element_line(colour = "black", size = 2.25)) +
   theme(axis.ticks.length= unit(.25, "cm")) +
  theme(axis.text = element_text(family="Arial", colour = "black", size = 30)) +
  theme(axis.title.x = element_text(family="Arial", colour = "black", size = 30)) +
  theme(axis.title.y = element_text(family="Arial", colour = "black", size = 30)) +
  theme(plot.title = element_text(face = "bold", hjust = 0.5)) +
  theme(legend.position="none") +
  ggsave("unc3_L4_AID_C_dur.jpeg", width = 7, height = 6, path = "/Users/troymcdiarmid/Documents/Reversibility_materials/Figures/unc3/L4_recovery/habituation")

##Plot speed habituation

mean_cleanrawsrev_filt <- mean_cleanrawsrev %>% 
  filter(genotype %in% c("OH13988N", "OH13988C"))
speed_SEM_filt <- speed_SEM %>% 
  filter(genotype %in% c("OH13988N", "OH13988C"))
ggplot(mean_cleanrawsrev_filt, aes(stimulus_num, rev_speed, colour = genotype)) +
  geom_line(size = 1) +
  theme_classic() + 
  geom_errorbar(aes(ymin=rev_speed-speed_SEM_filt$speed_sem, ymax=rev_speed+speed_SEM_filt$speed_sem), width = 0, size = 1) +
  scale_y_continuous(expand = c(0,0),
                     limits = c(0,0.5)) +
  geom_point(aes(shape=genotype), size = 4.25, fill = "white", stroke = 1.25) +
  scale_shape_manual(values=c(16,16,16)) +
  scale_size_manual(values=c(4.25,4.25,4.25)) +
  scale_color_manual(values=c("black", "dodgerblue2", "gray39", "#EDBD44")) +
  labs(title = "", x = "Stimulus number", y = "Reversal speed (mm/s)") +
  theme(axis.line = element_line(colour = 'black', size = 2.25)) +
  theme(axis.ticks = element_line(colour = "black", size = 2.25)) +
   theme(axis.ticks.length= unit(.25, "cm")) +
  theme(axis.text = element_text(family="Arial", colour = "black", size = 30)) +
  theme(axis.title.x = element_text(family="Arial", colour = "black", size = 30)) +
  theme(axis.title.y = element_text(family="Arial", colour = "black", size = 30)) +
  theme(plot.title = element_text(face = "bold", hjust = 0.5)) +
  theme(legend.position="none") +
  ggsave("unc3_L4_AID_C_speed.jpeg", width = 7, height = 6, path = "/Users/troymcdiarmid/Documents/Reversibility_materials/Figures/unc3/L4_recovery/habituation")

##Habituation unc-3::AID::GFP continous degradation vs. non-treated and developmental degradtion/adult recovery

mean_cleanrawsrev_filt <- mean_cleanrawsrev %>% 
  filter(genotype %in% c("OH13988N", "OH13988C", "OH13988D"))
prob_SEM_filt <- prob_SEM %>% 
  filter(genotype %in% c("OH13988N", "OH13988C", "OH13988D"))
ggplot(mean_cleanrawsrev_filt, aes(stimulus_num, rev_prob, colour = genotype)) +
  theme_classic() + 
  geom_line(size = 1) + 
  geom_errorbar(aes(ymin=rev_prob-prob_SEM_filt$prob_sem, ymax=rev_prob+prob_SEM_filt$prob_sem), width = 0, size = 1) +
  scale_y_continuous(expand = c(0,0),
                     limits = c(0,1.00)) +
  geom_point(aes(shape=genotype), size = 4.25, fill = "white", stroke = 1.25) +
  scale_shape_manual(values=c(16,16,16)) +
  scale_size_manual(values=c(4.25,4.25,4.25)) +
  scale_colour_manual(values = c("black", "dodgerblue2", "gray39", "#EDBD44")) +
  labs(title = "", x = "Stimulus number", y = "Reversal probability") +
  theme(axis.line = element_line(colour = 'black', size = 2.25)) +
  theme(axis.ticks = element_line(colour = "black", size = 2.25)) +
  theme(axis.ticks.length= unit(.25, "cm")) +
  theme(axis.text = element_text(family="Arial", colour = "black", size = 30)) +
  theme(axis.title.x = element_text(family="Arial", colour = "black", size = 30)) +
  theme(axis.title.y = element_text(family="Arial", colour = "black", size = 30)) +
  theme(legend.position="none") +
  theme(plot.title = element_text(face = "bold", hjust = 0.5)) 
  ggsave("unc3_L4_AID_C_D_prob.jpeg", width = 7, height = 6, path = "/Users/troymcdiarmid/Documents/Reversibility_materials/Figures/unc3/L4_recovery/habituation")
  
#Plot of duration habituation
  
mean_cleanrawsrev_filt <- mean_cleanrawsrev %>% 
  filter(genotype %in% c("OH13988N", "OH13988C", "OH13988D"))
dur_SEM_filt <- dur_SEM %>% 
  filter(genotype %in% c("OH13988N", "OH13988C", "OH13988D"))
ggplot(mean_cleanrawsrev_filt, aes(stimulus_num, rev_dur, colour = genotype)) + 
  geom_line(size = 1) +
  theme_classic() + 
  geom_errorbar(aes(ymin=rev_dur-dur_SEM_filt$dur_sem, ymax=rev_dur+dur_SEM_filt$dur_sem), width = 0, size = 1) +
  scale_y_continuous(expand = c(0,0),
                     limits = c(0,4)) +
  geom_point(aes(shape=genotype), size = 4.25, fill = "white", stroke = 1.25) +
  scale_shape_manual(values=c(16,16,16)) +
  scale_size_manual(values=c(4.25,4.25,4.25)) +
  scale_color_manual(values=c("black", "dodgerblue2", "gray39", "#EDBD44")) +
  labs(title = "", x = "Stimulus number", y = "Reversal duration (S)") +
  theme(axis.line = element_line(colour = 'black', size = 2.25)) +
  theme(axis.ticks = element_line(colour = "black", size = 2.25)) +
   theme(axis.ticks.length= unit(.25, "cm")) +
  theme(axis.text = element_text(family="Arial", colour = "black", size = 30)) +
  theme(axis.title.x = element_text(family="Arial", colour = "black", size = 30)) +
  theme(axis.title.y = element_text(family="Arial", colour = "black", size = 30)) +
  theme(plot.title = element_text(face = "bold", hjust = 0.5)) +
  theme(legend.position="none") +
  ggsave("unc3_L4_AID_C_D_dur.jpeg", width = 7, height = 6, path = "/Users/troymcdiarmid/Documents/Reversibility_materials/Figures/unc3/L4_recovery/habituation")

##Plot speed habituation

mean_cleanrawsrev_filt <- mean_cleanrawsrev %>% 
  filter(genotype %in% c("OH13988N", "OH13988C", "OH13988D"))
speed_SEM_filt <- speed_SEM %>% 
  filter(genotype %in% c("OH13988N", "OH13988C", "OH13988D"))
ggplot(mean_cleanrawsrev_filt, aes(stimulus_num, rev_speed, colour = genotype)) +
  geom_line(size = 1) +
  theme_classic() + 
  geom_errorbar(aes(ymin=rev_speed-speed_SEM_filt$speed_sem, ymax=rev_speed+speed_SEM_filt$speed_sem), width = 0, size = 1) +
  scale_y_continuous(expand = c(0,0),
                     limits = c(0,0.5)) +
  geom_point(aes(shape=genotype), size = 4.25, fill = "white", stroke = 1.25) +
  scale_shape_manual(values=c(16,16,16)) +
  scale_size_manual(values=c(4.25,4.25,4.25)) +
  scale_color_manual(values=c("black", "dodgerblue2", "gray39", "#EDBD44")) +
  labs(title = "", x = "Stimulus number", y = "Reversal speed (mm/s)") +
  theme(axis.line = element_line(colour = 'black', size = 2.25)) +
  theme(axis.ticks = element_line(colour = "black", size = 2.25)) +
   theme(axis.ticks.length= unit(.25, "cm")) +
  theme(axis.text = element_text(family="Arial", colour = "black", size = 30)) +
  theme(axis.title.x = element_text(family="Arial", colour = "black", size = 30)) +
  theme(axis.title.y = element_text(family="Arial", colour = "black", size = 30)) +
  theme(plot.title = element_text(face = "bold", hjust = 0.5)) +
  theme(legend.position="none") +
  ggsave("unc3_L4_AID_C_D_speed.jpeg", width = 7, height = 6, path = "/Users/troymcdiarmid/Documents/Reversibility_materials/Figures/unc3/L4_recovery/habituation")

##Habituation unc-3::AID::GFP continous degradation vs. non-treated and adult inactivation

mean_cleanrawsrev_filt <- mean_cleanrawsrev %>% 
  filter(genotype %in% c("OH13988N", "OH13988C", "OH13988A"))
prob_SEM_filt <- prob_SEM %>% 
  filter(genotype %in% c("OH13988N", "OH13988C", "OH13988A"))
ggplot(mean_cleanrawsrev_filt, aes(stimulus_num, rev_prob, colour = genotype)) +
  theme_classic() + 
  geom_line(size = 1) + 
  geom_errorbar(aes(ymin=rev_prob-prob_SEM_filt$prob_sem, ymax=rev_prob+prob_SEM_filt$prob_sem), width = 0, size = 1) +
  scale_y_continuous(expand = c(0,0),
                     limits = c(0,1.00)) +
  geom_point(aes(shape=genotype), size = 4.25, fill = "white", stroke = 1.25) +
  scale_shape_manual(values=c(16,16,16)) +
  scale_size_manual(values=c(4.25,4.25,4.25)) +
  scale_colour_manual(values = c("black", "dodgerblue2", "#EDBD44", "gray39")) +
  labs(title = "", x = "Stimulus number", y = "Reversal probability") +
  theme(axis.line = element_line(colour = 'black', size = 2.25)) +
  theme(axis.ticks = element_line(colour = "black", size = 2.25)) +
  theme(axis.ticks.length= unit(.25, "cm")) +
  theme(axis.text = element_text(family="Arial", colour = "black", size = 30)) +
  theme(axis.title.x = element_text(family="Arial", colour = "black", size = 30)) +
  theme(axis.title.y = element_text(family="Arial", colour = "black", size = 30)) +
  theme(legend.position="none") +
  theme(plot.title = element_text(face = "bold", hjust = 0.5)) 
  ggsave("unc3_L4_AID_C_A_prob.jpeg", width = 7, height = 6, path = "/Users/troymcdiarmid/Documents/Reversibility_materials/Figures/unc3/L4_recovery/habituation")
  
#Plot of duration habituation
  
mean_cleanrawsrev_filt <- mean_cleanrawsrev %>% 
  filter(genotype %in% c("OH13988N", "OH13988C", "OH13988A"))
dur_SEM_filt <- dur_SEM %>% 
  filter(genotype %in% c("OH13988N", "OH13988C", "OH13988A"))
ggplot(mean_cleanrawsrev_filt, aes(stimulus_num, rev_dur, colour = genotype)) + 
  geom_line(size = 1) +
  theme_classic() + 
  geom_errorbar(aes(ymin=rev_dur-dur_SEM_filt$dur_sem, ymax=rev_dur+dur_SEM_filt$dur_sem), width = 0, size = 1) +
  scale_y_continuous(expand = c(0,0),
                     limits = c(0,4)) +
  geom_point(aes(shape=genotype), size = 4.25, fill = "white", stroke = 1.25) +
  scale_shape_manual(values=c(16,16,16)) +
  scale_size_manual(values=c(4.25,4.25,4.25)) +
  scale_color_manual(values=c("black", "dodgerblue2", "#EDBD44", "gray39")) +
  labs(title = "", x = "Stimulus number", y = "Reversal duration (S)") +
  theme(axis.line = element_line(colour = 'black', size = 2.25)) +
  theme(axis.ticks = element_line(colour = "black", size = 2.25)) +
   theme(axis.ticks.length= unit(.25, "cm")) +
  theme(axis.text = element_text(family="Arial", colour = "black", size = 30)) +
  theme(axis.title.x = element_text(family="Arial", colour = "black", size = 30)) +
  theme(axis.title.y = element_text(family="Arial", colour = "black", size = 30)) +
  theme(plot.title = element_text(face = "bold", hjust = 0.5)) +
  theme(legend.position="none") +
  ggsave("unc3_L4_AID_C_A_dur.jpeg", width = 7, height = 6, path = "/Users/troymcdiarmid/Documents/Reversibility_materials/Figures/unc3/L4_recovery/habituation")

##Plot speed habituation

mean_cleanrawsrev_filt <- mean_cleanrawsrev %>% 
  filter(genotype %in% c("OH13988N", "OH13988C", "OH13988A"))
speed_SEM_filt <- speed_SEM %>% 
  filter(genotype %in% c("OH13988N", "OH13988C", "OH13988A"))
ggplot(mean_cleanrawsrev_filt, aes(stimulus_num, rev_speed, colour = genotype)) +
  geom_line(size = 1) +
  theme_classic() + 
  geom_errorbar(aes(ymin=rev_speed-speed_SEM_filt$speed_sem, ymax=rev_speed+speed_SEM_filt$speed_sem), width = 0, size = 1) +
  scale_y_continuous(expand = c(0,0),
                     limits = c(0,0.5)) +
  geom_point(aes(shape=genotype), size = 4.25, fill = "white", stroke = 1.25) +
  scale_shape_manual(values=c(16,16,16)) +
  scale_size_manual(values=c(4.25,4.25,4.25)) +
  scale_color_manual(values=c("black", "dodgerblue2", "#EDBD44", "gray39")) +
  labs(title = "", x = "Stimulus number", y = "Reversal speed (mm/s)") +
  theme(axis.line = element_line(colour = 'black', size = 2.25)) +
  theme(axis.ticks = element_line(colour = "black", size = 2.25)) +
   theme(axis.ticks.length= unit(.25, "cm")) +
  theme(axis.text = element_text(family="Arial", colour = "black", size = 30)) +
  theme(axis.title.x = element_text(family="Arial", colour = "black", size = 30)) +
  theme(axis.title.y = element_text(family="Arial", colour = "black", size = 30)) +
  theme(plot.title = element_text(face = "bold", hjust = 0.5)) +
  theme(legend.position="none") +
  ggsave("unc3_L4_AID_C_A_speed.jpeg", width = 7, height = 6, path = "/Users/troymcdiarmid/Documents/Reversibility_materials/Figures/unc3/L4_recovery/habituation")

##Habituation unc-3::AID::GFP continous degradation vs. adult and developmental degradation

mean_cleanrawsrev_filt <- mean_cleanrawsrev %>% 
  filter(genotype %in% c("OH13988N", "OH13988C", "OH13988A", "OH13988D"))
prob_SEM_filt <- prob_SEM %>% 
  filter(genotype %in% c("OH13988N", "OH13988C", "OH13988A", "OH13988D"))
ggplot(mean_cleanrawsrev_filt, aes(stimulus_num, rev_prob, colour = genotype)) +
  theme_classic() + 
  geom_line(size = 1) + 
  geom_errorbar(aes(ymin=rev_prob-prob_SEM_filt$prob_sem, ymax=rev_prob+prob_SEM_filt$prob_sem), width = 0, size = 1) +
  scale_y_continuous(expand = c(0,0),
                     limits = c(0,1.00)) +
  geom_point(aes(shape=genotype), size = 4.25, fill = "white", stroke = 1.25) +
  scale_shape_manual(values=c(16,16,16,16)) +
  scale_size_manual(values=c(4.25,4.25,4.25,4.25)) +
  scale_colour_manual(values = c("black", "dodgerblue2", "#EDBD44", "gray39")) +
  labs(title = "", x = "Stimulus number", y = "Reversal probability") +
  theme(axis.line = element_line(colour = 'black', size = 2.25)) +
  theme(axis.ticks = element_line(colour = "black", size = 2.25)) +
  theme(axis.ticks.length= unit(.25, "cm")) +
  theme(axis.text = element_text(family="Arial", colour = "black", size = 30)) +
  theme(axis.title.x = element_text(family="Arial", colour = "black", size = 30)) +
  theme(axis.title.y = element_text(family="Arial", colour = "black", size = 30)) +
  theme(legend.position="none") +
  theme(plot.title = element_text(face = "bold", hjust = 0.5)) 
  ggsave("unc3_L4_AID_C_A_D_prob.jpeg", width = 7, height = 6, path = "/Users/troymcdiarmid/Documents/Reversibility_materials/Figures/unc3/L4_recovery/habituation")
  
#Plot of duration habituation
  
mean_cleanrawsrev_filt <- mean_cleanrawsrev %>% 
  filter(genotype %in% c("OH13988N", "OH13988C", "OH13988A", "OH13988D"))
dur_SEM_filt <- dur_SEM %>% 
  filter(genotype %in% c("OH13988N", "OH13988C", "OH13988A", "OH13988D"))
ggplot(mean_cleanrawsrev_filt, aes(stimulus_num, rev_dur, colour = genotype)) + 
  geom_line(size = 1) +
  theme_classic() + 
  geom_errorbar(aes(ymin=rev_dur-dur_SEM_filt$dur_sem, ymax=rev_dur+dur_SEM_filt$dur_sem), width = 0, size = 1) +
  scale_y_continuous(expand = c(0,0),
                     limits = c(0,4)) +
  geom_point(aes(shape=genotype), size = 4.25, fill = "white", stroke = 1.25) +
  scale_shape_manual(values=c(16,16,16,16)) +
  scale_size_manual(values=c(4.25,4.25,4.25,4.25)) +
  scale_color_manual(values=c("black", "dodgerblue2", "#EDBD44", "gray39")) +
  labs(title = "", x = "Stimulus number", y = "Reversal duration (S)") +
  theme(axis.line = element_line(colour = 'black', size = 2.25)) +
  theme(axis.ticks = element_line(colour = "black", size = 2.25)) +
   theme(axis.ticks.length= unit(.25, "cm")) +
  theme(axis.text = element_text(family="Arial", colour = "black", size = 30)) +
  theme(axis.title.x = element_text(family="Arial", colour = "black", size = 30)) +
  theme(axis.title.y = element_text(family="Arial", colour = "black", size = 30)) +
  theme(plot.title = element_text(face = "bold", hjust = 0.5)) +
  theme(legend.position="none") +
  ggsave("unc3_L4_AID_C_A_D_dur.jpeg", width = 7, height = 6, path = "/Users/troymcdiarmid/Documents/Reversibility_materials/Figures/unc3/L4_recovery/habituation")

##Plot speed habituation

mean_cleanrawsrev_filt <- mean_cleanrawsrev %>% 
  filter(genotype %in% c("OH13988N", "OH13988C", "OH13988A", "OH13988D"))
speed_SEM_filt <- speed_SEM %>% 
  filter(genotype %in% c("OH13988N", "OH13988C", "OH13988A", "OH13988D"))
ggplot(mean_cleanrawsrev_filt, aes(stimulus_num, rev_speed, colour = genotype)) +
  geom_line(size = 1) +
  theme_classic() + 
  geom_errorbar(aes(ymin=rev_speed-speed_SEM_filt$speed_sem, ymax=rev_speed+speed_SEM_filt$speed_sem), width = 0, size = 1) +
  scale_y_continuous(expand = c(0,0),
                     limits = c(0,0.5)) +
  geom_point(aes(shape=genotype), size = 4.25, fill = "white", stroke = 1.25) +
  scale_shape_manual(values=c(16,16,16,16)) +
  scale_size_manual(values=c(4.25,4.25,4.25,4.25)) +
  scale_color_manual(values=c("black", "dodgerblue2", "#EDBD44", "gray39")) +
  labs(title = "", x = "Stimulus number", y = "Reversal speed (mm/s)") +
  theme(axis.line = element_line(colour = 'black', size = 2.25)) +
  theme(axis.ticks = element_line(colour = "black", size = 2.25)) +
   theme(axis.ticks.length= unit(.25, "cm")) +
  theme(axis.text = element_text(family="Arial", colour = "black", size = 30)) +
  theme(axis.title.x = element_text(family="Arial", colour = "black", size = 30)) +
  theme(axis.title.y = element_text(family="Arial", colour = "black", size = 30)) +
  theme(plot.title = element_text(face = "bold", hjust = 0.5)) +
  theme(legend.position="none") +
  ggsave("unc3_L4_AID_C_A_D_speed.jpeg", width = 7, height = 6, path = "/Users/troymcdiarmid/Documents/Reversibility_materials/Figures/unc3/L4_recovery/habituation")
  
```



```{r}

##Basic morphology features analysis

##Bash loop to output reversals and basic morphology from tracker plates (to be run in terminal)

for folder in $( ls ); do java -jar /Users/troymcdiarmid/Desktop/Chore.jar --segment --shadowless --pixelsize 0.027 --minimum-move-body 2 --minimum-time 20 --output width,length,morphwidth,curve,area,midline,pathlen,bias,dir,angular,aspect,kink,crab,speed --plugin Reoutline::despike --plugin Respine --plugin MeasureReversal::tap::dt=1::collect=0.5 $folder; done

##Bash argument to grep all .dat files into a summary of morphology (to be run in terminal)

grep -H '[.]*' $(find . -name '*.dat') > data.smorph

cd ../..

```


```{r}
##The following code creates a dataframe with all morphology and baseline locomotion measures throughout the tracking session.

##Comand to read .smorph file in 

setwd("/Volumes/SAMWISE/Troy/reversibility/unc_3/N2_unc3_AID_0120_2019/data")

rawsmorph <- read_table2("data.smorph", col_names = c("plate_id", "width", "length", "morphwidth", "curve", "area", "midline", "pathlen", "bias", "dir", "angular", "aspect", "kink", "crab", "speed"))

cleanrawsmorph <- rawsmorph %>% 
  separate(plate_id, into = c("garbage", "plate_id", "genotype"), sep ="/") %>%
  separate(genotype, into = c("genotype", "time"), sep = ":") %>% separate(genotype, into = c("genotype", "synch_conditions", "growth_conditions"), sep = "_") 

####Make time numeric and round time

cleanrawsmorph <- cleanrawsmorph %>% mutate(time = as.numeric(time)) %>% 
  mutate(time = round(time, digits = 0)) 

##Ordering the genotype factor for plotting
    
cleanrawsmorph$genotype <- factor(cleanrawsmorph$genotype,
    levels = c('OH13988N', 'OH13988C', 'OH13988D', 'OH13988A', ordered = TRUE))

##Filtering to exclude first 10s when the tracker has yet to calculate conistent measurements for certain metrics.

cleanrawsmorph <- cleanrawsmorph %>% 
  filter(between(cleanrawsmorph$time, 10, 1199))


```


```{r}
##Code to calculate mean of morphology metrics

mean_cleanrawsmorph_whole_session <- cleanrawsmorph %>% 
  select(genotype, time, width:speed) 

mean_cleanrawsmorph_whole_session <- mean_cleanrawsmorph_whole_session %>%  
  group_by(genotype, time) %>%
  summarize_all(mean) 


#Plots of morphology metrics for all groups

ggplot(mean_cleanrawsmorph_whole_session, aes(time, speed, colour = genotype)) + 
geom_line(size = 0.3) +
   scale_colour_manual(values = c("black", "dodgerblue2", "gray39", "#EDBD44")) +
    scale_y_continuous(expand = c(0,0),
                     limits = c(0, 0.3), breaks = c(0,0.1,0.2,0.3)) +
  scale_x_continuous(expand = c(0,0),
                     limits = c(0, 1260), breaks = c(0,300,600,900,1200)) +
  theme_classic() +
  labs(y = "Speed (mm/s)", x = "Time (s)") +
  theme(legend.position = "none") +
  theme(axis.line.y = element_line(colour = 'black', size = 0.4)) + 
  theme(axis.line.x = element_line(colour = 'black', size = 0.4)) +
  theme(axis.ticks.y = element_line(colour = "black", size = 0.4)) +
  theme(axis.ticks.length=unit(.03, "in")) +
  theme(axis.text = element_text(family="Arial", colour = "black", size = 12)) +
  theme(axis.title = element_text(family="Arial", colour = "black", size = 12)) +
ggsave("unc3_rev_speed_trace_l4.jpeg", width = 3.5, height = 2.5, path = "/Users/troymcdiarmid/Documents/Reversibility_materials/Figures/unc3/L4_recovery/morphology/")


ggplot(mean_cleanrawsmorph_whole_session, aes(time, curve, colour = genotype)) + 
geom_line(size = 0.3) +
  scale_colour_manual(values = c("black", "dodgerblue2", "gray39", "#EDBD44")) +
    scale_y_continuous(expand = c(0,0),
                     limits = c(0, 40), breaks = c(0,10,20,30,40)) +
  scale_x_continuous(expand = c(0,0),
                     limits = c(0, 1260), breaks = c(0,300,600,900,1200)) +
  theme_classic() +
  labs(y = "Curvature (radians)", x = "Time (s)") +
  theme(legend.position = "none") +
  theme(axis.line.y = element_line(colour = 'black', size = 0.4)) + 
  theme(axis.line.x = element_line(colour = 'black', size = 0.4)) +
  theme(axis.ticks.y = element_line(colour = "black", size = 0.4)) +
  theme(axis.ticks.length=unit(.03, "in")) +
  theme(axis.text = element_text(family="Arial", colour = "black", size = 12)) +
  theme(axis.title = element_text(family="Arial", colour = "black", size = 12)) +
ggsave("unc3_rev_curve_trace_l4.jpeg", width = 3, height = 2.5, path = "/Users/troymcdiarmid/Documents/Reversibility_materials/Figures/unc3/L4_recovery/morphology/")

ggplot(mean_cleanrawsmorph_whole_session, aes(time, kink, colour = genotype)) + 
geom_line(size = 1) +
   scale_colour_manual(values = c("black", "dodgerblue2", "gray39", "#EDBD44")) +
    scale_y_continuous(expand = c(0,0),
                     limits = c(0,100), breaks = c(0,25,50,75,100)) +
  scale_x_continuous(expand = c(0,0),
                     limits = c(0, 1260), breaks = c(0,300,600,900,1200)) +
  theme_classic() +
  labs(y = "Kink (radians)", x = "Time (S)") +
  theme(legend.position = "none") +
  theme(axis.line = element_line(colour = 'black', size = 2.25)) +
  theme(axis.ticks = element_line(colour = "black", size = 2.25)) +
  theme(axis.ticks.length= unit(.25, "cm")) +
  theme(axis.text = element_text(family="Arial", colour = "black", size = 30)) +
  theme(axis.title.x = element_text(family="Arial", colour = "black", size = 30)) +
  theme(axis.title.y = element_text(family="Arial", colour = "black", size = 30)) +
  theme(plot.margin = margin(15, 15, 15, 15)) +
ggsave("unc3_rev_kink_trace_l4.jpeg", width = 7, height = 6, path = "/Users/troymcdiarmid/Documents/Reversibility_materials/Figures/unc3/L4_recovery/morphology/")

ggplot(mean_cleanrawsmorph_whole_session, aes(time, length, colour = genotype)) + 
geom_line(size = 1) +
   scale_colour_manual(values = c("black", "dodgerblue2", "gray39", "#EDBD44")) +
    scale_y_continuous(expand = c(0,0),
                     limits = c(0, 1.25), breaks = c(0,0.25,0.5,0.75,1.0,1.25)) +
  scale_x_continuous(expand = c(0,0),
                     limits = c(0, 1260), breaks = c(0,300,600,900,1200)) +
  theme_classic() +
  labs(y = "Length (mm)", x = "Time (s)") +
  theme(legend.position = "none") +
  theme(axis.line = element_line(colour = 'black', size = 2.25)) +
  theme(axis.ticks = element_line(colour = "black", size = 2.25)) +
  theme(axis.ticks.length= unit(.25, "cm")) +
  theme(axis.text = element_text(family="Arial", colour = "black", size = 30)) +
  theme(axis.title.x = element_text(family="Arial", colour = "black", size = 30)) +
  theme(axis.title.y = element_text(family="Arial", colour = "black", size = 30)) +
  theme(plot.margin = margin(15, 15, 15, 15)) +
ggsave("unc3_rev_Length_trace_l4.jpeg", width = 7, height = 6, path = "/Users/troymcdiarmid/Documents/Reversibility_materials/Figures/unc3/L4_recovery/morphology/")

ggplot(mean_cleanrawsmorph_whole_session, aes(time, midline, colour = genotype)) + 
geom_line(size = 0.3) +
   scale_colour_manual(values = c("black", "dodgerblue2", "gray39", "#EDBD44")) +
    scale_y_continuous(expand = c(0,0),
                     limits = c(0.0, 1.25), breaks = c(0.0,0.25,0.5,0.75,1.00,1.25)) +
  scale_x_continuous(expand = c(0,0),
                     limits = c(0, 1260), breaks = c(0,300,600,900,1200)) +
  theme_classic() +
  labs(y = "Midline length (mm)", x = "Time (s)") +
  theme(legend.position = "none") +
  theme(axis.line.y = element_line(colour = 'black', size = 0.4)) + 
  theme(axis.line.x = element_line(colour = 'black', size = 0.4)) +
  theme(axis.ticks.y = element_line(colour = "black", size = 0.4)) +
  theme(axis.ticks.length=unit(.03, "in")) +
  theme(axis.text = element_text(family="Arial", colour = "black", size = 12)) +
  theme(axis.title = element_text(family="Arial", colour = "black", size = 12)) +
ggsave("unc3_rev_midline_trace_l4.jpeg", width = 3, height = 2.5, path = "/Users/troymcdiarmid/Documents/Reversibility_materials/Figures/unc3/L4_recovery/morphology/")

ggplot(mean_cleanrawsmorph_whole_session, aes(time, width, colour = genotype)) + 
geom_line(size = 0.3) +
   scale_colour_manual(values = c("black", "dodgerblue2", "gray39", "#EDBD44")) +
    scale_y_continuous(expand = c(0,0),
                     limits = c(0, 0.4), breaks = c(0.0,0.1,0.2,0.3,0.4)) +
  scale_x_continuous(expand = c(0,0),
                     limits = c(0, 1260), breaks = c(0,300,600,900,1200)) +
  theme_classic() +
  labs(y = "Width (mm)", x = "Time (s)") +
  theme(legend.position = "none") +
  theme(axis.line.y = element_line(colour = 'black', size = 0.4)) + 
  theme(axis.line.x = element_line(colour = 'black', size = 0.4)) +
  theme(axis.ticks.y = element_line(colour = "black", size = 0.4)) +
  theme(axis.ticks.length=unit(.03, "in")) +
  theme(axis.text = element_text(family="Arial", colour = "black", size = 12)) +
  theme(axis.title = element_text(family="Arial", colour = "black", size = 12)) +
ggsave("unc3_rev_width_trace_l4.jpeg", width = 3, height = 2.5, path = "/Users/troymcdiarmid/Documents/Reversibility_materials/Figures/unc3/L4_recovery/morphology/")

ggplot(mean_cleanrawsmorph_whole_session, aes(time, pathlen, colour = genotype)) + 
geom_line(size = 0.3) +
   scale_colour_manual(values = c("black", "dodgerblue2", "gray39", "#EDBD44")) +
    scale_y_continuous(expand = c(0,0),
                     limits = c(0, 25), breaks = c(0,5,10,15,20,25)) +
  scale_x_continuous(expand = c(0,0),
                     limits = c(0, 1260), breaks = c(0,300,600,900,1200)) +
  theme_classic() +
  labs(y = "Pathlength (mm)", x = "Time (s)") +
  theme(legend.position = "none") +
  theme(axis.line.y = element_line(colour = 'black', size = 0.4)) + 
  theme(axis.line.x = element_line(colour = 'black', size = 0.4)) +
  theme(axis.ticks.y = element_line(colour = "black", size = 0.4)) +
  theme(axis.ticks.length=unit(.03, "in")) +
  theme(axis.text = element_text(family="Arial", colour = "black", size = 12)) +
  theme(axis.title = element_text(family="Arial", colour = "black", size = 12)) +
ggsave("unc3_rev_pathlength_trace_l4.jpeg", width = 3, height = 2.5, path = "/Users/troymcdiarmid/Documents/Reversibility_materials/Figures/unc3/L4_recovery/morphology/")

ggplot(mean_cleanrawsmorph_whole_session, aes(time, bias, colour = genotype)) + 
geom_line(size = 0.3) +
   scale_colour_manual(values = c("black", "dodgerblue2", "gray39", "#EDBD44")) +
    scale_y_continuous(expand = c(0,0),
                     limits = c(-1, 1), breaks = c(-1.0,-0.5,0,0.5,1.0)) +
  scale_x_continuous(expand = c(0,0),
                     limits = c(0, 1260), breaks = c(0,300,600,900,1200)) +
  theme_classic() +
  labs(y = "Direction bias", x = "Time (s)") +
  theme(legend.position = "none") +
  theme(axis.line.y = element_line(colour = 'black', size = 0.4)) + 
  theme(axis.line.x = element_line(colour = 'black', size = 0.4)) +
  theme(axis.ticks.y = element_line(colour = "black", size = 0.4)) +
  theme(axis.ticks.length=unit(.03, "in")) +
  theme(axis.text = element_text(family="Arial", colour = "black", size = 12)) +
  theme(axis.title = element_text(family="Arial", colour = "black", size = 12)) +
ggsave("unc3_rev_bias_trace_l4.jpeg", width = 3, height = 2.5, path = "/Users/troymcdiarmid/Documents/Reversibility_materials/Figures/unc3/L4_recovery/morphology/")

ggplot(mean_cleanrawsmorph_whole_session, aes(time, dir, colour = genotype)) + 
geom_line(size = 0.3) +
   scale_colour_manual(values = c("black", "dodgerblue2", "gray39", "#EDBD44")) +
    scale_y_continuous(expand = c(0,0),
                     limits = c(0, 0.06), breaks = c(0,0.02,0.04,0.06)) +
  scale_x_continuous(expand = c(0,0),
                     limits = c(0, 1260), breaks = c(0,300,600,900,1200)) +
  theme_classic() +
  labs(y = "Direction change", x = "Time (s)") +
  theme(legend.position = "none") +
  theme(axis.line.y = element_line(colour = 'black', size = 0.4)) + 
  theme(axis.line.x = element_line(colour = 'black', size = 0.4)) +
  theme(axis.ticks.y = element_line(colour = "black", size = 0.4)) +
  theme(axis.ticks.length=unit(.03, "in")) +
  theme(axis.text = element_text(family="Arial", colour = "black", size = 12)) +
  theme(axis.title = element_text(family="Arial", colour = "black", size = 12)) +
ggsave("unc3_rev_dir_trace_l4.jpeg", width = 3, height = 2.5, path = "/Users/troymcdiarmid/Documents/Reversibility_materials/Figures/unc3/L4_recovery/morphology/")

ggplot(mean_cleanrawsmorph_whole_session, aes(time, crab, colour = genotype)) + 
geom_line(size = 0.3) +
   scale_colour_manual(values = c("black", "dodgerblue2", "gray39", "#EDBD44")) +
    scale_y_continuous(expand = c(0,0),
                     limits = c(0, 0.06), breaks = c(0,0.02,0.04,0.06)) +
  scale_x_continuous(expand = c(0,0),
                     limits = c(0, 1260), breaks = c(0,300,600,900,1200)) +
  theme_classic() +
  labs(y = "Horizontal speed (mm/s)", x = "Time (s)") +
  theme(legend.position = "none") +
  theme(axis.line.y = element_line(colour = 'black', size = 0.4)) + 
  theme(axis.line.x = element_line(colour = 'black', size = 0.4)) +
  theme(axis.ticks.y = element_line(colour = "black", size = 0.4)) +
  theme(axis.ticks.length=unit(.03, "in")) +
  theme(axis.text = element_text(family="Arial", colour = "black", size = 12)) +
  theme(axis.title = element_text(family="Arial", colour = "black", size = 12)) +
ggsave("unc3_rev_crab_trace_l4.jpeg", width = 3, height = 2.5, path = "/Users/troymcdiarmid/Documents/Reversibility_materials/Figures/unc3/L4_recovery/morphology/")

ggplot(mean_cleanrawsmorph_whole_session, aes(time, aspect, colour = genotype)) + 
geom_line(size = 0.3) +
   scale_colour_manual(values = c("black", "dodgerblue2", "gray39", "#EDBD44")) +
    scale_y_continuous(expand = c(0,0),
                     limits = c(0.0, 0.6), breaks = c(0,0.2,0.4,0.6)) +
  scale_x_continuous(expand = c(0,0),
                     limits = c(0, 1260), breaks = c(0,300,600,900,1200)) +
  theme_classic() +
  labs(y = "Aspect (width to length ratio)", x = "Time (s)") +
  theme(legend.position = "none") +
  theme(axis.line.y = element_line(colour = 'black', size = 0.4)) + 
  theme(axis.line.x = element_line(colour = 'black', size = 0.4)) +
  theme(axis.ticks.y = element_line(colour = "black", size = 0.4)) +
  theme(axis.ticks.length=unit(.03, "in")) +
  theme(axis.text = element_text(family="Arial", colour = "black", size = 12)) +
  theme(axis.title = element_text(family="Arial", colour = "black", size = 12)) +
ggsave("unc3_rev_aspect_trace_l4.jpeg", width = 3, height = 2.5, path = "/Users/troymcdiarmid/Documents/Reversibility_materials/Figures/unc3/L4_recovery/morphology/")


ggplot(mean_cleanrawsmorph_whole_session, aes(time, angular, colour = genotype)) + 
geom_line(size = 0.3) +
   scale_colour_manual(values = c("black", "dodgerblue2", "gray39", "#EDBD44")) +
    scale_y_continuous(expand = c(0,0),
                     limits = c(0, 30), breaks = c(0,10,20,30)) +
  scale_x_continuous(expand = c(0,0),
                     limits = c(0, 1260), breaks = c(0,300,600,900,1200)) +
  theme_classic() +
  labs(y = "Angular speed (radians/second)", x = "Time (s)") +
  theme(legend.position = "none") +
  theme(axis.line.y = element_line(colour = 'black', size = 0.4)) + 
  theme(axis.line.x = element_line(colour = 'black', size = 0.4)) +
  theme(axis.ticks.y = element_line(colour = "black", size = 0.4)) +
  theme(axis.ticks.length=unit(.03, "in")) +
  theme(axis.text = element_text(family="Arial", colour = "black", size = 12)) +
  theme(axis.title = element_text(family="Arial", colour = "black", size = 12)) +
ggsave("unc3_rev_angular_trace_l4.jpeg", width = 3, height = 2.5, path = "/Users/troymcdiarmid/Documents/Reversibility_materials/Figures/unc3/L4_recovery/morphology/")



```


```{r}

##Maing midline length violin plot

##Code to remove all 0 measurement entries and focus on the baseline period (300-599 seconds) which occurs after the worms have acclimated to the tracker but prior to the delivery of mechanosensory stimuli 

cleanrawsmorph_baseline <- cleanrawsmorph %>% 
  filter(between(cleanrawsmorph$time, 300, 599))


##Code to calculate mean of morphology metrics accross plates

mean_cleanrawsmorph <- cleanrawsmorph_baseline %>% 
  dplyr::select(genotype, plate_id, width:speed) 

mean_cleanrawsmorph <- mean_cleanrawsmorph %>%  
  group_by(genotype, plate_id) %>%
  summarize_all(mean) 

##Calculating absolute means and Sds across genomes 

genotype_means <- mean_cleanrawsmorph %>% 
  summarise_all(mean) 

genotype_sds <- mean_cleanrawsmorph %>% 
  summarise_all(sd) 

##Plotting length

ggplot(mean_cleanrawsmorph, aes(genotype, length, colour = genotype)) +
  geom_jitter(size = 1, width = 0.25) +
  geom_errorbar(data = genotype_means, aes(ymin=length-genotype_sds$length, ymax=length+genotype_sds$length), width = 0, size = 0.4, colour = "black") +
  geom_point(data =  df_means, aes(genotype, length, fill = genotype), colour = "black", shape = 21) +
  scale_colour_manual(values = c("black", "dodgerblue2", "gray39", "#EDBD44")) +
  scale_fill_manual(values = c("black", "dodgerblue2", "gray39", "#EDBD44")) +
  scale_y_continuous(expand = c(0,0),
                     limits = c(0.5,1.25), breaks = c(0.5,0.75,1.0,1.25)) +
  theme_classic() +
  labs(y = "Length (mm)", x = "") +
  theme(legend.title= element_text(family="Arial Bold")) +
  theme(legend.position = "none") +
  theme(axis.line = element_line(colour = 'black', size = 0.6)) + 
  theme(legend.position = "none") +
  theme(axis.ticks.y = element_line(colour = "black", size = 0.6)) +
  theme(axis.ticks.x = element_line(colour = "black", size = 0)) +
  theme(axis.ticks.length=unit(.03, "in")) +
  theme(axis.text = element_text(family="Arial", colour = "black", size = 11)) +
  theme(axis.text.x = element_text(family="Arial", colour = "black", size = 0)) +
  theme(axis.title = element_text(family="Arial", colour = "black", size = 11)) +
ggsave("unc3_rev_length_dot_mean.jpeg", width = 2.1, height = 2.3, path = "/Users/troymcdiarmid/Desktop/")

##Fit a linear model and estimate signficance of group differences with adjusted p-values. 

fit <- summary(lm(kink~genotype, mean_cleanrawsmorph))

tidy_fit <- tidy(fit)  

qvals <- p.adjust(tidy_fit$p.value, "BH")

tidy_fit$q.vals <- qvals

pairwise.t.test(x = mean_cleanrawsmorph$length, g = mean_cleanrawsmorph$genotype, p.adjust.method = "bonf")


##Plotting kink

ggplot(mean_cleanrawsmorph, aes(genotype, kink, colour = genotype)) +
  geom_jitter(size = 1, width = 0.25) +
  geom_errorbar(data = genotype_means, aes(ymin=kink-genotype_sds$kink, ymax=kink+genotype_sds$kink), width = 0, size = 0.5, colour = "black") +
  geom_point(data =  df_means, aes(genotype, kink, fill = genotype), colour = "black", shape = 21) +
  scale_colour_manual(values = c("black", "dodgerblue2", "gray39", "#EDBD44")) +
  scale_fill_manual(values = c("black", "dodgerblue2", "gray39", "#EDBD44")) +
  scale_y_continuous(expand = c(0,0),
                     limits = c(25,100), breaks = c(25,50,75,100)) +
  theme_classic() +
  labs(y = "Kink (radians)", x = "") +
  theme(legend.title= element_text(family="Arial Bold")) +
  theme(legend.position = "none") +
  theme(axis.line = element_line(colour = 'black', size = 0.6)) + 
  theme(legend.position = "none") +
  theme(axis.ticks.y = element_line(colour = "black", size = 0.6)) +
  theme(axis.ticks.x = element_line(colour = "black", size = 0)) +
  theme(axis.ticks.length=unit(.03, "in")) +
  theme(axis.text = element_text(family="Arial", colour = "black", size = 11)) +
  theme(axis.text.x = element_text(family="Arial", colour = "black", size = 0)) +
  theme(axis.title = element_text(family="Arial", colour = "black", size = 11)) +
ggsave("unc3_rev_kink_dot_mean.jpeg", width = 2.1, height = 2.3, path = "/Users/troymcdiarmid/Desktop/")


##Fit a linear model and estimate signficance of group differences with adjusted p-values. 

fit <- summary(lm(kink~genotype, mean_cleanrawsmorph))

tidy_fit <- tidy(fit)  

qvals <- p.adjust(tidy_fit$p.value, "BH")

tidy_fit$q.vals <- qvals

pairwise.t.test(x = mean_cleanrawsmorph$kink, g = mean_cleanrawsmorph$genotype, p.adjust.method = "bonf")



```






##Analysis for the 1 day recovery run 2






```{r setup, include=FALSE}
##Bash loop to call choreography to output reversals from each tracker plate data file generated by the tracker

for folder in $( ls ); do java -jar /Users/troymcdiarmid/Desktop/Chore.jar --segment --shadowless --pixelsize 0.027 --minimum-move-body 2 --minimum-time 20 --output width,length,morphwidth,curve,area,midline,pathlen,bias,dir,angular,aspect,kink,crab,speed --plugin Reoutline::despike --plugin Respine --plugin MeasureReversal::tap::dt=1::collect=0.5 $folder; done

##Bash argument to grep all .trv choreography output files into a summary of reversals
grep -H '[.]*' $(find . -name '*.rev') > data.srev
cd ../..
```


```{r}
##unc3 L2 (day 1) recovery

##Read in summary of reversal data file (data.srev) 

setwd("/Volumes/SAMWISE/Troy/reversibility/unc_3/OH13988_1DAY_AID_0821_2020/data")
cleanrawsrev <- read_table2("data.srev", col_names = c("plate_id", "already_rev", "not_rev", "rev", "rev_dist", "dist_sd", "dist_sem", "dist_0_quart", "dist_1st_quart", "dist_2nd_quart", "dist_3rd_quart", "dsit_100th_percentile", "rev_dur", "dur_sd", "dur_sem", "dur_0_quart", "dur_1st_quart", "dur_2nd_quart", "dur_3rd_quart", "dur_100th_percentile"))
cleanrawsrev <- cleanrawsrev %>% 
  separate(plate_id, into = c("garbage", "plate_id", "genotype"), sep ="/") %>%
  separate(genotype, into = c("genotype", "time"), sep = ":")  %>% 
  separate(genotype, into = c("genotype", "growth_conditions"), sep = "_") %>% 
  select(genotype:dur_100th_percentile)

##Optional Code to rename your factors

cleanrawsrev$genotype <- recode(cleanrawsrev$genotype, `N2` = "Wild-type (N2)")

##Make time numeric and round time 

cleanrawsrev <- cleanrawsrev %>% mutate(time = as.numeric(time)) %>% 
  mutate(time = round(time, digits = 0)) 

##Calculate reversal probability

cleanrawsrev <- cleanrawsrev %>% 
  mutate(rev_prob = rev / (not_rev + rev)) 

##optional code to remove any bad observtions

cleanrawsrev <- cleanrawsrev %>% 
  filter(!(rev_dist == "0")) 
cleanrawsrev <- cleanrawsrev %>% 
  filter(!(time == "659")) 
cleanrawsrev <- cleanrawsrev %>% 
  filter(!(time == "699")) 

##Calculate reversal speed 

cleanrawsrev <- cleanrawsrev %>%
  mutate(rev_speed = rev_dist / rev_dur) 



##Reorder factors

cleanrawsrev$genotype <- factor(cleanrawsrev$genotype,
    levels = c('OH13988N', 'OH13988C', 'OH13988A', 'OH13988D', 'N2C', ordered = TRUE))

##Mean rev data

mean_cleanrawsrev <- cleanrawsrev %>% 
  group_by(genotype, time) %>% 
  summarize_all(mean) 


##Set the reversal distances and durations to zero for OH13988A at 870 (none of the worms across any plates reversed to tap and so were filtered out at an earlier step and now must be added back in as zero measurements). 

mean_cleanrawsrev <- rbind(mean_cleanrawsrev, mean_cleanrawsrev[rep(121, 1), ]) %>% 
  arrange(genotype, time)

mean_cleanrawsrev$time[c(122)] <- c(880)
mean_cleanrawsrev$rev_dist[c(122)] <- c(0)
mean_cleanrawsrev$rev_dur[c(122)] <- c(0)
mean_cleanrawsrev$rev_prob[c(122)] <- c(0)
mean_cleanrawsrev$rev_speed[c(122)] <- c(0)

##Add stim number NOTE: this must be changed to fit your experiment parameters 

mean_cleanrawsrev$stimulus_num <- rep(1:31, times = 5) 


##SD calcs

prob_SD <- cleanrawsrev %>% 
  group_by(genotype, time) %>% 
  summarise(prob_sd = sd(rev_prob))
dur_SD <- cleanrawsrev %>% 
  group_by(genotype, time) %>% 
  summarise(dur_sd = sd(rev_dur))
speed_SD <- cleanrawsrev %>% 
  group_by(genotype, time) %>% 
  summarise(speed_sd = sd(rev_speed))
dist_SD <- cleanrawsrev %>% 
  group_by(genotype, time) %>% 
  summarise(dist_sd = sd(rev_dist))

##SEM calcs

prob_SEM <- cleanrawsrev %>% 
  group_by(genotype, time) %>% 
  summarise(prob_sem = sd(rev_prob)/sqrt(length(rev_prob)))
dur_SEM <- cleanrawsrev %>% 
  group_by(genotype, time) %>% 
  summarise(dur_sem = sd(rev_dur)/sqrt(length(rev_dur)))
dist_SEM <- cleanrawsrev %>% 
  group_by(genotype, time) %>% 
  summarise(dist_sem = sd(rev_dist)/sqrt(length(rev_dist)))
speed_SEM <- cleanrawsrev %>% 
  group_by(genotype, time) %>% 
  summarise(speed_sem = sd(rev_speed)/sqrt(length(rev_speed)))

```


```{r}
##Plots of mean reversal probability nlg-1::AID::GFP VS N2 both with no Auxin treatment

mean_cleanrawsrev_filt <- mean_cleanrawsrev %>% 
  filter(genotype %in% c("OH13988N", "OH13988C"))
prob_SEM_filt <- prob_SEM %>% 
  filter(genotype %in% c("OH13988N", "OH13988C"))
ggplot(mean_cleanrawsrev_filt, aes(stimulus_num, rev_prob, colour = genotype)) +
  theme_classic() + 
  geom_line(size = 1) + 
  geom_errorbar(aes(ymin=rev_prob-prob_SEM_filt$prob_sem, ymax=rev_prob+prob_SEM_filt$prob_sem), width = 0, size = 1) +
  scale_y_continuous(expand = c(0,0),
                     limits = c(0,1.00)) +
  geom_point(aes(shape=genotype), size = 4.25, fill = "white", stroke = 1.25) +
  scale_shape_manual(values=c(16,16,16)) +
  scale_size_manual(values=c(4.25,4.25,4.25)) +
  scale_colour_manual(values = c("black", "dodgerblue2", "#EDBD44", "gray39")) +
  labs(title = "", x = "Stimulus number", y = "Reversal probability") +
  theme(axis.line = element_line(colour = 'black', size = 2.25)) +
  theme(axis.ticks = element_line(colour = "black", size = 2.25)) +
  theme(axis.ticks.length= unit(.25, "cm")) +
  theme(axis.text = element_text(family="Arial", colour = "black", size = 30)) +
  theme(axis.title.x = element_text(family="Arial", colour = "black", size = 30)) +
  theme(axis.title.y = element_text(family="Arial", colour = "black", size = 30)) +
  theme(legend.position="none") +
  theme(plot.title = element_text(face = "bold", hjust = 0.5)) 
  ggsave("unc3_L2_AID_C_prob.jpeg", width = 7, height = 6, path = "/Users/troymcdiarmid/Documents/Reversibility_materials/Figures/unc3/L2_recovery/habituation")
  
#Plot of duration habituation
  
mean_cleanrawsrev_filt <- mean_cleanrawsrev %>% 
  filter(genotype %in% c("OH13988N", "OH13988C"))
dur_SEM_filt <- dur_SEM %>% 
  filter(genotype %in% c("OH13988N", "OH13988C"))
ggplot(mean_cleanrawsrev_filt, aes(stimulus_num, rev_dur, colour = genotype)) + 
  geom_line(size = 1) +
  theme_classic() + 
  geom_errorbar(aes(ymin=rev_dur-dur_SEM_filt$dur_sem, ymax=rev_dur+dur_SEM_filt$dur_sem), width = 0, size = 1) +
  scale_y_continuous(expand = c(0,0),
                     limits = c(0,4)) +
  geom_point(aes(shape=genotype), size = 4.25, fill = "white", stroke = 1.25) +
  scale_shape_manual(values=c(16,16,16)) +
  scale_size_manual(values=c(4.25,4.25,4.25)) +
  scale_color_manual(values=c("black", "dodgerblue2", "#EDBD44", "gray39")) +
  labs(title = "", x = "Stimulus number", y = "Reversal duration (S)") +
  theme(axis.line = element_line(colour = 'black', size = 2.25)) +
  theme(axis.ticks = element_line(colour = "black", size = 2.25)) +
   theme(axis.ticks.length= unit(.25, "cm")) +
  theme(axis.text = element_text(family="Arial", colour = "black", size = 30)) +
  theme(axis.title.x = element_text(family="Arial", colour = "black", size = 30)) +
  theme(axis.title.y = element_text(family="Arial", colour = "black", size = 30)) +
  theme(plot.title = element_text(face = "bold", hjust = 0.5)) +
  theme(legend.position="none") +
  ggsave("unc3_L2_AID_C_dur.jpeg", width = 7, height = 6, path = "/Users/troymcdiarmid/Documents/Reversibility_materials/Figures/unc3/L2_recovery/habituation")

##Plot speed habituation

mean_cleanrawsrev_filt <- mean_cleanrawsrev %>% 
  filter(genotype %in% c("OH13988N", "OH13988C"))
speed_SEM_filt <- speed_SEM %>% 
  filter(genotype %in% c("OH13988N", "OH13988C"))
ggplot(mean_cleanrawsrev_filt, aes(stimulus_num, rev_speed, colour = genotype)) +
  geom_line(size = 1) +
  theme_classic() + 
  geom_errorbar(aes(ymin=rev_speed-speed_SEM_filt$speed_sem, ymax=rev_speed+speed_SEM_filt$speed_sem), width = 0, size = 1) +
  scale_y_continuous(expand = c(0,0),
                     limits = c(0,0.5)) +
  geom_point(aes(shape=genotype), size = 4.25, fill = "white", stroke = 1.25) +
  scale_shape_manual(values=c(16,16,16)) +
  scale_size_manual(values=c(4.25,4.25,4.25)) +
  scale_color_manual(values=c("black", "dodgerblue2", "gray39", "#EDBD44")) +
  labs(title = "", x = "Stimulus number", y = "Reversal speed (mm/s)") +
  theme(axis.line = element_line(colour = 'black', size = 2.25)) +
  theme(axis.ticks = element_line(colour = "black", size = 2.25)) +
   theme(axis.ticks.length= unit(.25, "cm")) +
  theme(axis.text = element_text(family="Arial", colour = "black", size = 30)) +
  theme(axis.title.x = element_text(family="Arial", colour = "black", size = 30)) +
  theme(axis.title.y = element_text(family="Arial", colour = "black", size = 30)) +
  theme(plot.title = element_text(face = "bold", hjust = 0.5)) +
  theme(legend.position="none") +
  ggsave("unc3_L2_AID_C_speed.jpeg", width = 7, height = 6, path = "/Users/troymcdiarmid/Documents/Reversibility_materials/Figures/unc3/L2_recovery/habituation")

##Habituation unc-3::AID::GFP continous degradation vs. non-treated and developmental degradtion/adult recovery

mean_cleanrawsrev_filt <- mean_cleanrawsrev %>% 
  filter(genotype %in% c("OH13988N", "OH13988C", "OH13988D"))
prob_SEM_filt <- prob_SEM %>% 
  filter(genotype %in% c("OH13988N", "OH13988C", "OH13988D"))
ggplot(mean_cleanrawsrev_filt, aes(stimulus_num, rev_prob, colour = genotype)) +
  theme_classic() + 
  geom_line(size = 1) + 
  geom_errorbar(aes(ymin=rev_prob-prob_SEM_filt$prob_sem, ymax=rev_prob+prob_SEM_filt$prob_sem), width = 0, size = 1) +
  scale_y_continuous(expand = c(0,0),
                     limits = c(0,1.00)) +
  geom_point(aes(shape=genotype), size = 4.25, fill = "white", stroke = 1.25) +
  scale_shape_manual(values=c(16,16,16)) +
  scale_size_manual(values=c(4.25,4.25,4.25)) +
  scale_colour_manual(values = c("black", "dodgerblue2", "gray39", "#EDBD44")) +
  labs(title = "", x = "Stimulus number", y = "Reversal probability") +
  theme(axis.line = element_line(colour = 'black', size = 2.25)) +
  theme(axis.ticks = element_line(colour = "black", size = 2.25)) +
  theme(axis.ticks.length= unit(.25, "cm")) +
  theme(axis.text = element_text(family="Arial", colour = "black", size = 30)) +
  theme(axis.title.x = element_text(family="Arial", colour = "black", size = 30)) +
  theme(axis.title.y = element_text(family="Arial", colour = "black", size = 30)) +
  theme(legend.position="none") +
  theme(plot.title = element_text(face = "bold", hjust = 0.5)) 
  ggsave("unc3_L2_AID_C_D_prob.jpeg", width = 7, height = 6, path = "/Users/troymcdiarmid/Documents/Reversibility_materials/Figures/unc3/L2_recovery/habituation")
  
#Plot of duration habituation
  
mean_cleanrawsrev_filt <- mean_cleanrawsrev %>% 
  filter(genotype %in% c("OH13988N", "OH13988C", "OH13988D"))
dur_SEM_filt <- dur_SEM %>% 
  filter(genotype %in% c("OH13988N", "OH13988C", "OH13988D"))
ggplot(mean_cleanrawsrev_filt, aes(stimulus_num, rev_dur, colour = genotype)) + 
  geom_line(size = 1) +
  theme_classic() + 
  geom_errorbar(aes(ymin=rev_dur-dur_SEM_filt$dur_sem, ymax=rev_dur+dur_SEM_filt$dur_sem), width = 0, size = 1) +
  scale_y_continuous(expand = c(0,0),
                     limits = c(0,4)) +
  geom_point(aes(shape=genotype), size = 4.25, fill = "white", stroke = 1.25) +
  scale_shape_manual(values=c(16,16,16)) +
  scale_size_manual(values=c(4.25,4.25,4.25)) +
  scale_color_manual(values=c("black", "dodgerblue2", "gray39", "#EDBD44")) +
  labs(title = "", x = "Stimulus number", y = "Reversal duration (S)") +
  theme(axis.line = element_line(colour = 'black', size = 2.25)) +
  theme(axis.ticks = element_line(colour = "black", size = 2.25)) +
   theme(axis.ticks.length= unit(.25, "cm")) +
  theme(axis.text = element_text(family="Arial", colour = "black", size = 30)) +
  theme(axis.title.x = element_text(family="Arial", colour = "black", size = 30)) +
  theme(axis.title.y = element_text(family="Arial", colour = "black", size = 30)) +
  theme(plot.title = element_text(face = "bold", hjust = 0.5)) +
  theme(legend.position="none") +
  ggsave("unc3_L2_AID_C_D_dur.jpeg", width = 7, height = 6, path = "/Users/troymcdiarmid/Documents/Reversibility_materials/Figures/unc3/L2_recovery/habituation")

##Plot speed habituation

mean_cleanrawsrev_filt <- mean_cleanrawsrev %>% 
  filter(genotype %in% c("OH13988N", "OH13988C", "OH13988D"))
speed_SEM_filt <- speed_SEM %>% 
  filter(genotype %in% c("OH13988N", "OH13988C", "OH13988D"))
ggplot(mean_cleanrawsrev_filt, aes(stimulus_num, rev_speed, colour = genotype)) +
  geom_line(size = 1) +
  theme_classic() + 
  geom_errorbar(aes(ymin=rev_speed-speed_SEM_filt$speed_sem, ymax=rev_speed+speed_SEM_filt$speed_sem), width = 0, size = 1) +
  scale_y_continuous(expand = c(0,0),
                     limits = c(0,0.5)) +
  geom_point(aes(shape=genotype), size = 4.25, fill = "white", stroke = 1.25) +
  scale_shape_manual(values=c(16,16,16)) +
  scale_size_manual(values=c(4.25,4.25,4.25)) +
  scale_color_manual(values=c("black", "dodgerblue2", "gray39", "#EDBD44")) +
  labs(title = "", x = "Stimulus number", y = "Reversal speed (mm/s)") +
  theme(axis.line = element_line(colour = 'black', size = 2.25)) +
  theme(axis.ticks = element_line(colour = "black", size = 2.25)) +
   theme(axis.ticks.length= unit(.25, "cm")) +
  theme(axis.text = element_text(family="Arial", colour = "black", size = 30)) +
  theme(axis.title.x = element_text(family="Arial", colour = "black", size = 30)) +
  theme(axis.title.y = element_text(family="Arial", colour = "black", size = 30)) +
  theme(plot.title = element_text(face = "bold", hjust = 0.5)) +
  theme(legend.position="none") +
  ggsave("unc3_L2_AID_C_D_speed.jpeg", width = 7, height = 6, path = "/Users/troymcdiarmid/Documents/Reversibility_materials/Figures/unc3/L2_recovery/habituation")

##Habituation unc-3::AID::GFP continous degradation vs. non-treated and adult inactivation

mean_cleanrawsrev_filt <- mean_cleanrawsrev %>% 
  filter(genotype %in% c("OH13988N", "OH13988C", "OH13988A"))
prob_SEM_filt <- prob_SEM %>% 
  filter(genotype %in% c("OH13988N", "OH13988C", "OH13988A"))
ggplot(mean_cleanrawsrev_filt, aes(stimulus_num, rev_prob, colour = genotype)) +
  theme_classic() + 
  geom_line(size = 1) + 
  geom_errorbar(aes(ymin=rev_prob-prob_SEM_filt$prob_sem, ymax=rev_prob+prob_SEM_filt$prob_sem), width = 0, size = 1) +
  scale_y_continuous(expand = c(0,0),
                     limits = c(0,1.00)) +
  geom_point(aes(shape=genotype), size = 4.25, fill = "white", stroke = 1.25) +
  scale_shape_manual(values=c(16,16,16)) +
  scale_size_manual(values=c(4.25,4.25,4.25)) +
  scale_colour_manual(values = c("black", "dodgerblue2", "#EDBD44", "gray39")) +
  labs(title = "", x = "Stimulus number", y = "Reversal probability") +
  theme(axis.line = element_line(colour = 'black', size = 2.25)) +
  theme(axis.ticks = element_line(colour = "black", size = 2.25)) +
  theme(axis.ticks.length= unit(.25, "cm")) +
  theme(axis.text = element_text(family="Arial", colour = "black", size = 30)) +
  theme(axis.title.x = element_text(family="Arial", colour = "black", size = 30)) +
  theme(axis.title.y = element_text(family="Arial", colour = "black", size = 30)) +
  theme(legend.position="none") +
  theme(plot.title = element_text(face = "bold", hjust = 0.5)) 
  ggsave("unc3_L2_AID_C_A_prob.jpeg", width = 7, height = 6, path = "/Users/troymcdiarmid/Documents/Reversibility_materials/Figures/unc3/L2_recovery/habituation")
  
#Plot of duration habituation
  
mean_cleanrawsrev_filt <- mean_cleanrawsrev %>% 
  filter(genotype %in% c("OH13988N", "OH13988C", "OH13988A"))
dur_SEM_filt <- dur_SEM %>% 
  filter(genotype %in% c("OH13988N", "OH13988C", "OH13988A"))
ggplot(mean_cleanrawsrev_filt, aes(stimulus_num, rev_dur, colour = genotype)) + 
  geom_line(size = 1) +
  theme_classic() + 
  geom_errorbar(aes(ymin=rev_dur-dur_SEM_filt$dur_sem, ymax=rev_dur+dur_SEM_filt$dur_sem), width = 0, size = 1) +
  scale_y_continuous(expand = c(0,0),
                     limits = c(0,4)) +
  geom_point(aes(shape=genotype), size = 4.25, fill = "white", stroke = 1.25) +
  scale_shape_manual(values=c(16,16,16)) +
  scale_size_manual(values=c(4.25,4.25,4.25)) +
  scale_color_manual(values=c("black", "dodgerblue2", "#EDBD44", "gray39")) +
  labs(title = "", x = "Stimulus number", y = "Reversal duration (S)") +
  theme(axis.line = element_line(colour = 'black', size = 2.25)) +
  theme(axis.ticks = element_line(colour = "black", size = 2.25)) +
   theme(axis.ticks.length= unit(.25, "cm")) +
  theme(axis.text = element_text(family="Arial", colour = "black", size = 30)) +
  theme(axis.title.x = element_text(family="Arial", colour = "black", size = 30)) +
  theme(axis.title.y = element_text(family="Arial", colour = "black", size = 30)) +
  theme(plot.title = element_text(face = "bold", hjust = 0.5)) +
  theme(legend.position="none") +
  ggsave("unc3_L2_AID_C_A_dur.jpeg", width = 7, height = 6, path = "/Users/troymcdiarmid/Documents/Reversibility_materials/Figures/unc3/L2_recovery/habituation")

##Plot speed habituation

mean_cleanrawsrev_filt <- mean_cleanrawsrev %>% 
  filter(genotype %in% c("OH13988N", "OH13988C", "OH13988A"))
speed_SEM_filt <- speed_SEM %>% 
  filter(genotype %in% c("OH13988N", "OH13988C", "OH13988A"))
ggplot(mean_cleanrawsrev_filt, aes(stimulus_num, rev_speed, colour = genotype)) +
  geom_line(size = 1) +
  theme_classic() + 
  geom_errorbar(aes(ymin=rev_speed-speed_SEM_filt$speed_sem, ymax=rev_speed+speed_SEM_filt$speed_sem), width = 0, size = 1) +
  scale_y_continuous(expand = c(0,0),
                     limits = c(0,0.5)) +
  geom_point(aes(shape=genotype), size = 4.25, fill = "white", stroke = 1.25) +
  scale_shape_manual(values=c(16,16,16)) +
  scale_size_manual(values=c(4.25,4.25,4.25)) +
  scale_color_manual(values=c("black", "dodgerblue2", "#EDBD44", "gray39")) +
  labs(title = "", x = "Stimulus number", y = "Reversal speed (mm/s)") +
  theme(axis.line = element_line(colour = 'black', size = 2.25)) +
  theme(axis.ticks = element_line(colour = "black", size = 2.25)) +
   theme(axis.ticks.length= unit(.25, "cm")) +
  theme(axis.text = element_text(family="Arial", colour = "black", size = 30)) +
  theme(axis.title.x = element_text(family="Arial", colour = "black", size = 30)) +
  theme(axis.title.y = element_text(family="Arial", colour = "black", size = 30)) +
  theme(plot.title = element_text(face = "bold", hjust = 0.5)) +
  theme(legend.position="none") +
  ggsave("unc3_L2_AID_C_A_speed.jpeg", width = 7, height = 6, path = "/Users/troymcdiarmid/Documents/Reversibility_materials/Figures/unc3/L2_recovery/habituation")

##Habituation unc-3::AID::GFP continous degradation vs. adult and developmental degradation

mean_cleanrawsrev_filt <- mean_cleanrawsrev %>% 
  filter(genotype %in% c("OH13988N", "OH13988C", "OH13988A", "OH13988D"))
prob_SEM_filt <- prob_SEM %>% 
  filter(genotype %in% c("OH13988N", "OH13988C", "OH13988A", "OH13988D"))
ggplot(mean_cleanrawsrev_filt, aes(stimulus_num, rev_prob, colour = genotype)) +
  theme_classic() + 
  geom_line(size = 1) + 
  geom_errorbar(aes(ymin=rev_prob-prob_SEM_filt$prob_sem, ymax=rev_prob+prob_SEM_filt$prob_sem), width = 0, size = 1) +
  scale_y_continuous(expand = c(0,0),
                     limits = c(0,1.00)) +
  geom_point(aes(shape=genotype), size = 4.25, fill = "white", stroke = 1.25) +
  scale_shape_manual(values=c(16,16,16,16)) +
  scale_size_manual(values=c(4.25,4.25,4.25,4.25)) +
  scale_colour_manual(values = c("black", "dodgerblue2", "#EDBD44", "gray39")) +
  labs(title = "", x = "Stimulus number", y = "Reversal probability") +
  theme(axis.line = element_line(colour = 'black', size = 2.25)) +
  theme(axis.ticks = element_line(colour = "black", size = 2.25)) +
  theme(axis.ticks.length= unit(.25, "cm")) +
  theme(axis.text = element_text(family="Arial", colour = "black", size = 30)) +
  theme(axis.title.x = element_text(family="Arial", colour = "black", size = 30)) +
  theme(axis.title.y = element_text(family="Arial", colour = "black", size = 30)) +
  theme(legend.position="none") +
  theme(plot.title = element_text(face = "bold", hjust = 0.5)) 
  ggsave("unc3_L2_AID_C_A_D_prob.jpeg", width = 7, height = 6, path = "/Users/troymcdiarmid/Documents/Reversibility_materials/Figures/unc3/L2_recovery/habituation")
  
#Plot of duration habituation
  
mean_cleanrawsrev_filt <- mean_cleanrawsrev %>% 
  filter(genotype %in% c("OH13988N", "OH13988C", "OH13988A", "OH13988D"))
dur_SEM_filt <- dur_SEM %>% 
  filter(genotype %in% c("OH13988N", "OH13988C", "OH13988A", "OH13988D"))
ggplot(mean_cleanrawsrev_filt, aes(stimulus_num, rev_dur, colour = genotype)) + 
  geom_line(size = 1) +
  theme_classic() + 
  geom_errorbar(aes(ymin=rev_dur-dur_SEM_filt$dur_sem, ymax=rev_dur+dur_SEM_filt$dur_sem), width = 0, size = 1) +
  scale_y_continuous(expand = c(0,0),
                     limits = c(0,4)) +
  geom_point(aes(shape=genotype), size = 4.25, fill = "white", stroke = 1.25) +
  scale_shape_manual(values=c(16,16,16,16)) +
  scale_size_manual(values=c(4.25,4.25,4.25,4.25)) +
  scale_color_manual(values=c("black", "dodgerblue2", "#EDBD44", "gray39")) +
  labs(title = "", x = "Stimulus number", y = "Reversal duration (S)") +
  theme(axis.line = element_line(colour = 'black', size = 2.25)) +
  theme(axis.ticks = element_line(colour = "black", size = 2.25)) +
   theme(axis.ticks.length= unit(.25, "cm")) +
  theme(axis.text = element_text(family="Arial", colour = "black", size = 30)) +
  theme(axis.title.x = element_text(family="Arial", colour = "black", size = 30)) +
  theme(axis.title.y = element_text(family="Arial", colour = "black", size = 30)) +
  theme(plot.title = element_text(face = "bold", hjust = 0.5)) +
  theme(legend.position="none") +
  ggsave("unc3_L2_AID_C_A_D_dur.jpeg", width = 7, height = 6, path = "/Users/troymcdiarmid/Documents/Reversibility_materials/Figures/unc3/L2_recovery/habituation")

##Plot speed habituation

mean_cleanrawsrev_filt <- mean_cleanrawsrev %>% 
  filter(genotype %in% c("OH13988N", "OH13988C", "OH13988A", "OH13988D"))
speed_SEM_filt <- speed_SEM %>% 
  filter(genotype %in% c("OH13988N", "OH13988C", "OH13988A", "OH13988D"))
ggplot(mean_cleanrawsrev_filt, aes(stimulus_num, rev_speed, colour = genotype)) +
  geom_line(size = 1) +
  theme_classic() + 
  geom_errorbar(aes(ymin=rev_speed-speed_SEM_filt$speed_sem, ymax=rev_speed+speed_SEM_filt$speed_sem), width = 0, size = 1) +
  scale_y_continuous(expand = c(0,0),
                     limits = c(0,0.5)) +
  geom_point(aes(shape=genotype), size = 4.25, fill = "white", stroke = 1.25) +
  scale_shape_manual(values=c(16,16,16,16)) +
  scale_size_manual(values=c(4.25,4.25,4.25,4.25)) +
  scale_color_manual(values=c("black", "dodgerblue2", "#EDBD44", "gray39")) +
  labs(title = "", x = "Stimulus number", y = "Reversal speed (mm/s)") +
  theme(axis.line = element_line(colour = 'black', size = 2.25)) +
  theme(axis.ticks = element_line(colour = "black", size = 2.25)) +
   theme(axis.ticks.length= unit(.25, "cm")) +
  theme(axis.text = element_text(family="Arial", colour = "black", size = 30)) +
  theme(axis.title.x = element_text(family="Arial", colour = "black", size = 30)) +
  theme(axis.title.y = element_text(family="Arial", colour = "black", size = 30)) +
  theme(plot.title = element_text(face = "bold", hjust = 0.5)) +
  theme(legend.position="none") +
  ggsave("unc3_L2_AID_C_A_D_speed.jpeg", width = 7, height = 6, path = "/Users/troymcdiarmid/Documents/Reversibility_materials/Figures/unc3/L2_recovery/habituation")
  
```



```{r}
##The following code creates a dataframe with all morphology and baseline locomotion measures throughout the tracking session.

##Comand to read .smorph file in 

setwd("/Volumes/SAMWISE/Troy/reversibility/unc_3/OH13988_1DAY_AID_0821_2020/data")

rawsmorph <- read_table2("data.smorph", col_names = c("plate_id", "width", "length", "morphwidth", "curve", "area", "midline", "pathlen", "bias", "dir", "angular", "aspect", "kink", "crab", "speed"))

cleanrawsmorph <- rawsmorph %>% 
  separate(plate_id, into = c("garbage", "plate_id", "genotype"), sep ="/") %>%
  separate(genotype, into = c("genotype", "time"), sep = ":") %>% separate(genotype, into = c("genotype", "synch_conditions", "growth_conditions"), sep = "_") 

####Make time numeric and round time

cleanrawsmorph <- cleanrawsmorph %>% mutate(time = as.numeric(time)) %>% 
  mutate(time = round(time, digits = 0)) 

##Ordering the genotype factor for plotting
    
cleanrawsmorph$genotype <- factor(cleanrawsmorph$genotype,
    levels = c('OH13988N', 'OH13988C', 'OH13988D', 'OH13988A', 'N2C', ordered = TRUE))

##Filtering to exclude first 10s when the tracker has yet to calculate conistent measurements for certain metrics.

cleanrawsmorph <- cleanrawsmorph %>% 
  filter(between(cleanrawsmorph$time, 10, 1199)) %>% 
  filter(!(genotype == 'N2C'))

```


```{r}
##Code to calculate mean of morphology metrics

mean_cleanrawsmorph_whole_session <- cleanrawsmorph %>% 
  select(genotype, time, width:speed) 

mean_cleanrawsmorph_whole_session <- mean_cleanrawsmorph_whole_session %>%  
  group_by(genotype, time) %>%
  summarize_all(mean) 

#Plots of morphology metrics for all groups

ggplot(mean_cleanrawsmorph_whole_session, aes(time, speed, colour = genotype)) + 
geom_line(size = 0.3) +
   scale_colour_manual(values = c("black", "dodgerblue2", "gray39", "#EDBD44")) +
    scale_y_continuous(expand = c(0,0),
                     limits = c(0, 0.3), breaks = c(0,0.1,0.2,0.3)) +
  scale_x_continuous(expand = c(0,0),
                     limits = c(0, 1260), breaks = c(0,300,600,900,1200)) +
  theme_classic() +
  labs(y = "Speed (mm/s)", x = "Time (s)") +
  theme(legend.position = "none") +
  theme(axis.line.y = element_line(colour = 'black', size = 0.4)) + 
  theme(axis.line.x = element_line(colour = 'black', size = 0.4)) +
  theme(axis.ticks.y = element_line(colour = "black", size = 0.4)) +
  theme(axis.ticks.length=unit(.03, "in")) +
  theme(axis.text = element_text(family="Arial", colour = "black", size = 12)) +
  theme(axis.title = element_text(family="Arial", colour = "black", size = 12)) +
ggsave("unc3_rev_speed_trace_l2.jpeg", width = 3.5, height = 2.5, path = "/Users/troymcdiarmid/Documents/Reversibility_materials/Figures/unc3/L2_recovery/morphology/")


ggplot(mean_cleanrawsmorph_whole_session, aes(time, curve, colour = genotype)) + 
geom_line(size = 0.3) +
  scale_colour_manual(values = c("black", "dodgerblue2", "gray39", "#EDBD44")) +
    scale_y_continuous(expand = c(0,0),
                     limits = c(0, 40), breaks = c(0,10,20,30,40)) +
  scale_x_continuous(expand = c(0,0),
                     limits = c(0, 1260), breaks = c(0,300,600,900,1200)) +
  theme_classic() +
  labs(y = "Curvature (radians)", x = "Time (s)") +
  theme(legend.position = "none") +
  theme(axis.line.y = element_line(colour = 'black', size = 0.4)) + 
  theme(axis.line.x = element_line(colour = 'black', size = 0.4)) +
  theme(axis.ticks.y = element_line(colour = "black", size = 0.4)) +
  theme(axis.ticks.length=unit(.03, "in")) +
  theme(axis.text = element_text(family="Arial", colour = "black", size = 12)) +
  theme(axis.title = element_text(family="Arial", colour = "black", size = 12)) +
ggsave("unc3_rev_curve_trace_l2.jpeg", width = 3, height = 2.5, path = "/Users/troymcdiarmid/Documents/Reversibility_materials/Figures/unc3/L2_recovery/morphology/")

ggplot(mean_cleanrawsmorph_whole_session, aes(time, kink, colour = genotype)) + 
geom_line(size = 1) +
   scale_colour_manual(values = c("black", "dodgerblue2", "gray39", "#EDBD44")) +
    scale_y_continuous(expand = c(0,0),
                     limits = c(0,100), breaks = c(0,25,50,75,100)) +
  scale_x_continuous(expand = c(0,0),
                     limits = c(0, 1260), breaks = c(0,300,600,900,1200)) +
  theme_classic() +
  labs(y = "Kink (radians)", x = "Time (S)") +
  theme(legend.position = "none") +
  theme(axis.line = element_line(colour = 'black', size = 2.25)) +
  theme(axis.ticks = element_line(colour = "black", size = 2.25)) +
  theme(axis.ticks.length= unit(.25, "cm")) +
  theme(axis.text = element_text(family="Arial", colour = "black", size = 30)) +
  theme(axis.title.x = element_text(family="Arial", colour = "black", size = 30)) +
  theme(axis.title.y = element_text(family="Arial", colour = "black", size = 30)) +
  theme(plot.margin = margin(15, 15, 15, 15)) +
ggsave("unc3_rev_kink_trace_l2.jpeg", width = 7, height = 6, path = "/Users/troymcdiarmid/Documents/Reversibility_materials/Figures/unc3/L2_recovery/morphology/")

ggplot(mean_cleanrawsmorph_whole_session, aes(time, length, colour = genotype)) + 
geom_line(size = 1) +
   scale_colour_manual(values = c("black", "dodgerblue2", "gray39", "#EDBD44")) +
    scale_y_continuous(expand = c(0,0),
                     limits = c(0, 1.25), breaks = c(0,0.25,0.5,0.75,1.0,1.25)) +
  scale_x_continuous(expand = c(0,0),
                     limits = c(0, 1260), breaks = c(0,300,600,900,1200)) +
  theme_classic() +
  labs(y = "Length (mm)", x = "Time (s)") +
  theme(legend.position = "none") +
  theme(axis.line = element_line(colour = 'black', size = 2.25)) +
  theme(axis.ticks = element_line(colour = "black", size = 2.25)) +
  theme(axis.ticks.length= unit(.25, "cm")) +
  theme(axis.text = element_text(family="Arial", colour = "black", size = 30)) +
  theme(axis.title.x = element_text(family="Arial", colour = "black", size = 30)) +
  theme(axis.title.y = element_text(family="Arial", colour = "black", size = 30)) +
  theme(plot.margin = margin(15, 15, 15, 15)) +
ggsave("unc3_rev_Length_trace_l2.jpeg", width = 7, height = 6, path = "/Users/troymcdiarmid/Documents/Reversibility_materials/Figures/unc3/L2_recovery/morphology/")

ggplot(mean_cleanrawsmorph_whole_session, aes(time, midline, colour = genotype)) + 
geom_line(size = 0.3) +
   scale_colour_manual(values = c("black", "dodgerblue2", "gray39", "#EDBD44")) +
    scale_y_continuous(expand = c(0,0),
                     limits = c(0.0, 1.25), breaks = c(0.0,0.25,0.5,0.75,1.00,1.25)) +
  scale_x_continuous(expand = c(0,0),
                     limits = c(0, 1260), breaks = c(0,300,600,900,1200)) +
  theme_classic() +
  labs(y = "Midline length (mm)", x = "Time (s)") +
  theme(legend.position = "none") +
  theme(axis.line.y = element_line(colour = 'black', size = 0.4)) + 
  theme(axis.line.x = element_line(colour = 'black', size = 0.4)) +
  theme(axis.ticks.y = element_line(colour = "black", size = 0.4)) +
  theme(axis.ticks.length=unit(.03, "in")) +
  theme(axis.text = element_text(family="Arial", colour = "black", size = 12)) +
  theme(axis.title = element_text(family="Arial", colour = "black", size = 12)) +
ggsave("unc3_rev_midline_trace_l2.jpeg", width = 3, height = 2.5, path = "/Users/troymcdiarmid/Documents/Reversibility_materials/Figures/unc3/L2_recovery/morphology/")

ggplot(mean_cleanrawsmorph_whole_session, aes(time, width, colour = genotype)) + 
geom_line(size = 0.3) +
   scale_colour_manual(values = c("black", "dodgerblue2", "gray39", "#EDBD44")) +
    scale_y_continuous(expand = c(0,0),
                     limits = c(0, 0.4), breaks = c(0.0,0.1,0.2,0.3,0.4)) +
  scale_x_continuous(expand = c(0,0),
                     limits = c(0, 1260), breaks = c(0,300,600,900,1200)) +
  theme_classic() +
  labs(y = "Width (mm)", x = "Time (s)") +
  theme(legend.position = "none") +
  theme(axis.line.y = element_line(colour = 'black', size = 0.4)) + 
  theme(axis.line.x = element_line(colour = 'black', size = 0.4)) +
  theme(axis.ticks.y = element_line(colour = "black", size = 0.4)) +
  theme(axis.ticks.length=unit(.03, "in")) +
  theme(axis.text = element_text(family="Arial", colour = "black", size = 12)) +
  theme(axis.title = element_text(family="Arial", colour = "black", size = 12)) +
ggsave("unc3_rev_width_trace_l2.jpeg", width = 3, height = 2.5, path = "/Users/troymcdiarmid/Documents/Reversibility_materials/Figures/unc3/L2_recovery/morphology/")

ggplot(mean_cleanrawsmorph_whole_session, aes(time, pathlen, colour = genotype)) + 
geom_line(size = 0.3) +
   scale_colour_manual(values = c("black", "dodgerblue2", "gray39", "#EDBD44")) +
    scale_y_continuous(expand = c(0,0),
                     limits = c(0, 25), breaks = c(0,5,10,15,20,25)) +
  scale_x_continuous(expand = c(0,0),
                     limits = c(0, 1260), breaks = c(0,300,600,900,1200)) +
  theme_classic() +
  labs(y = "Pathlength (mm)", x = "Time (s)") +
  theme(legend.position = "none") +
  theme(axis.line.y = element_line(colour = 'black', size = 0.4)) + 
  theme(axis.line.x = element_line(colour = 'black', size = 0.4)) +
  theme(axis.ticks.y = element_line(colour = "black", size = 0.4)) +
  theme(axis.ticks.length=unit(.03, "in")) +
  theme(axis.text = element_text(family="Arial", colour = "black", size = 12)) +
  theme(axis.title = element_text(family="Arial", colour = "black", size = 12)) +
ggsave("unc3_rev_pathlength_trace_l2.jpeg", width = 3, height = 2.5, path = "/Users/troymcdiarmid/Documents/Reversibility_materials/Figures/unc3/L2_recovery/morphology/")

ggplot(mean_cleanrawsmorph_whole_session, aes(time, bias, colour = genotype)) + 
geom_line(size = 0.3) +
   scale_colour_manual(values = c("black", "dodgerblue2", "gray39", "#EDBD44")) +
    scale_y_continuous(expand = c(0,0),
                     limits = c(-1, 1), breaks = c(-1.0,-0.5,0,0.5,1.0)) +
  scale_x_continuous(expand = c(0,0),
                     limits = c(0, 1260), breaks = c(0,300,600,900,1200)) +
  theme_classic() +
  labs(y = "Direction bias", x = "Time (s)") +
  theme(legend.position = "none") +
  theme(axis.line.y = element_line(colour = 'black', size = 0.4)) + 
  theme(axis.line.x = element_line(colour = 'black', size = 0.4)) +
  theme(axis.ticks.y = element_line(colour = "black", size = 0.4)) +
  theme(axis.ticks.length=unit(.03, "in")) +
  theme(axis.text = element_text(family="Arial", colour = "black", size = 12)) +
  theme(axis.title = element_text(family="Arial", colour = "black", size = 12)) +
ggsave("unc3_rev_bias_trace_l2.jpeg", width = 3, height = 2.5, path = "/Users/troymcdiarmid/Documents/Reversibility_materials/Figures/unc3/L2_recovery/morphology/")

ggplot(mean_cleanrawsmorph_whole_session, aes(time, dir, colour = genotype)) + 
geom_line(size = 0.3) +
   scale_colour_manual(values = c("black", "dodgerblue2", "gray39", "#EDBD44")) +
    scale_y_continuous(expand = c(0,0),
                     limits = c(0, 0.06), breaks = c(0,0.02,0.04,0.06)) +
  scale_x_continuous(expand = c(0,0),
                     limits = c(0, 1260), breaks = c(0,300,600,900,1200)) +
  theme_classic() +
  labs(y = "Direction change", x = "Time (s)") +
  theme(legend.position = "none") +
  theme(axis.line.y = element_line(colour = 'black', size = 0.4)) + 
  theme(axis.line.x = element_line(colour = 'black', size = 0.4)) +
  theme(axis.ticks.y = element_line(colour = "black", size = 0.4)) +
  theme(axis.ticks.length=unit(.03, "in")) +
  theme(axis.text = element_text(family="Arial", colour = "black", size = 12)) +
  theme(axis.title = element_text(family="Arial", colour = "black", size = 12)) +
ggsave("unc3_rev_dir_trace_l2.jpeg", width = 3, height = 2.5, path = "/Users/troymcdiarmid/Documents/Reversibility_materials/Figures/unc3/L2_recovery/morphology/")

ggplot(mean_cleanrawsmorph_whole_session, aes(time, crab, colour = genotype)) + 
geom_line(size = 0.3) +
   scale_colour_manual(values = c("black", "dodgerblue2", "gray39", "#EDBD44")) +
    scale_y_continuous(expand = c(0,0),
                     limits = c(0, 0.06), breaks = c(0,0.02,0.04,0.06)) +
  scale_x_continuous(expand = c(0,0),
                     limits = c(0, 1260), breaks = c(0,300,600,900,1200)) +
  theme_classic() +
  labs(y = "Horizontal speed (mm/s)", x = "Time (s)") +
  theme(legend.position = "none") +
  theme(axis.line.y = element_line(colour = 'black', size = 0.4)) + 
  theme(axis.line.x = element_line(colour = 'black', size = 0.4)) +
  theme(axis.ticks.y = element_line(colour = "black", size = 0.4)) +
  theme(axis.ticks.length=unit(.03, "in")) +
  theme(axis.text = element_text(family="Arial", colour = "black", size = 12)) +
  theme(axis.title = element_text(family="Arial", colour = "black", size = 12)) +
ggsave("unc3_rev_crab_trace_l2.jpeg", width = 3, height = 2.5, path = "/Users/troymcdiarmid/Documents/Reversibility_materials/Figures/unc3/L2_recovery/morphology/")

ggplot(mean_cleanrawsmorph_whole_session, aes(time, aspect, colour = genotype)) + 
geom_line(size = 0.3) +
   scale_colour_manual(values = c("black", "dodgerblue2", "gray39", "#EDBD44")) +
    scale_y_continuous(expand = c(0,0),
                     limits = c(0.0, 0.6), breaks = c(0,0.2,0.4,0.6)) +
  scale_x_continuous(expand = c(0,0),
                     limits = c(0, 1260), breaks = c(0,300,600,900,1200)) +
  theme_classic() +
  labs(y = "Aspect (width to length ratio)", x = "Time (s)") +
  theme(legend.position = "none") +
  theme(axis.line.y = element_line(colour = 'black', size = 0.4)) + 
  theme(axis.line.x = element_line(colour = 'black', size = 0.4)) +
  theme(axis.ticks.y = element_line(colour = "black", size = 0.4)) +
  theme(axis.ticks.length=unit(.03, "in")) +
  theme(axis.text = element_text(family="Arial", colour = "black", size = 12)) +
  theme(axis.title = element_text(family="Arial", colour = "black", size = 12)) +
ggsave("unc3_rev_aspect_trace_l2.jpeg", width = 3, height = 2.5, path = "/Users/troymcdiarmid/Documents/Reversibility_materials/Figures/unc3/L2_recovery/morphology/")


ggplot(mean_cleanrawsmorph_whole_session, aes(time, angular, colour = genotype)) + 
geom_line(size = 0.3) +
   scale_colour_manual(values = c("black", "dodgerblue2", "gray39", "#EDBD44")) +
    scale_y_continuous(expand = c(0,0),
                     limits = c(0, 30), breaks = c(0,10,20,30)) +
  scale_x_continuous(expand = c(0,0),
                     limits = c(0, 1260), breaks = c(0,300,600,900,1200)) +
  theme_classic() +
  labs(y = "Angular speed (radians/second)", x = "Time (s)") +
  theme(legend.position = "none") +
  theme(axis.line.y = element_line(colour = 'black', size = 0.4)) + 
  theme(axis.line.x = element_line(colour = 'black', size = 0.4)) +
  theme(axis.ticks.y = element_line(colour = "black", size = 0.4)) +
  theme(axis.ticks.length=unit(.03, "in")) +
  theme(axis.text = element_text(family="Arial", colour = "black", size = 12)) +
  theme(axis.title = element_text(family="Arial", colour = "black", size = 12)) +
ggsave("unc3_rev_angular_trace_l2.jpeg", width = 3, height = 2.5, path = "/Users/troymcdiarmid/Documents/Reversibility_materials/Figures/unc3/L2_recovery/morphology/")

```






##Analysis for the 3 day recovery 






```{r setup, include=FALSE}
##Bash loop to call choreography to output reversals from each tracker plate data file generated by the tracker

for folder in $( ls ); do java -jar /Users/troymcdiarmid/Desktop/Chore.jar --segment --shadowless --pixelsize 0.027 --minimum-move-body 2 --minimum-time 20 --output width,length,morphwidth,curve,area,midline,pathlen,bias,dir,angular,aspect,kink,crab,speed --plugin Reoutline::despike --plugin Respine --plugin MeasureReversal::tap::dt=1::collect=0.5 $folder; done

##Bash argument to grep all .trv choreography output files into a summary of reversals
grep -H '[.]*' $(find . -name '*.rev') > data.srev
cd ../..
```


```{r}
##Baseline N2 vs nlg-1::AID::GFP test

##Read in summary of reversal data file (data.srev) 

setwd("/Volumes/SAMWISE/Troy/OH13988_AID_3DAY_0904_2020/data")
cleanrawsrev <- read_table2("data.srev", col_names = c("plate_id", "already_rev", "not_rev", "rev", "rev_dist", "dist_sd", "dist_sem", "dist_0_quart", "dist_1st_quart", "dist_2nd_quart", "dist_3rd_quart", "dsit_100th_percentile", "rev_dur", "dur_sd", "dur_sem", "dur_0_quart", "dur_1st_quart", "dur_2nd_quart", "dur_3rd_quart", "dur_100th_percentile"))
cleanrawsrev <- cleanrawsrev %>% 
  separate(plate_id, into = c("garbage", "plate_id", "genotype"), sep ="/") %>%
  separate(genotype, into = c("genotype", "time"), sep = ":")  %>% 
  separate(genotype, into = c("genotype", "growth_conditions"), sep = "_") %>% 
  select(genotype:dur_100th_percentile)

##Optional Code to rename your factors

cleanrawsrev$genotype <- recode(cleanrawsrev$genotype, `N2` = "Wild-type (N2)")

##Make time numeric and round time 

cleanrawsrev <- cleanrawsrev %>% mutate(time = as.numeric(time)) %>% 
  mutate(time = round(time, digits = 0)) 

##Calculate reversal probability

cleanrawsrev <- cleanrawsrev %>% 
  mutate(rev_prob = rev / (not_rev + rev)) 

##optional code to remove any bad observtions

cleanrawsrev <- cleanrawsrev %>% 
  filter(!(rev_dist == "0")) 
cleanrawsrev <- cleanrawsrev %>% 
  filter(!(time == "839")) 
cleanrawsrev <- cleanrawsrev %>% 
  filter(!(time == "659")) 

##Calculate reversal speed 

cleanrawsrev <- cleanrawsrev %>%
  mutate(rev_speed = rev_dist / rev_dur) 

##Reorder factors

cleanrawsrev$genotype <- factor(cleanrawsrev$genotype,
    levels = c('OH13988N', 'OH13988C', 'OH13988A', 'OH13988D', 'N2C', ordered = TRUE))

##Mean rev data

mean_cleanrawsrev <- cleanrawsrev %>% 
  group_by(genotype, time) %>% 
  summarize_all(mean) 

##Add stim number NOTE: this must be changed to fit your experiment parameters 

mean_cleanrawsrev$stimulus_num <- rep(1:31, times = 5) 

##SD calcs

prob_SD <- cleanrawsrev %>% 
  group_by(genotype, time) %>% 
  summarise(prob_sd = sd(rev_prob))
dur_SD <- cleanrawsrev %>% 
  group_by(genotype, time) %>% 
  summarise(dur_sd = sd(rev_dur))
speed_SD <- cleanrawsrev %>% 
  group_by(genotype, time) %>% 
  summarise(speed_sd = sd(rev_speed))
dist_SD <- cleanrawsrev %>% 
  group_by(genotype, time) %>% 
  summarise(dist_sd = sd(rev_dist))

##SEM calcs

prob_SEM <- cleanrawsrev %>% 
  group_by(genotype, time) %>% 
  summarise(prob_sem = sd(rev_prob)/sqrt(length(rev_prob)))
dur_SEM <- cleanrawsrev %>% 
  group_by(genotype, time) %>% 
  summarise(dur_sem = sd(rev_dur)/sqrt(length(rev_dur)))
dist_SEM <- cleanrawsrev %>% 
  group_by(genotype, time) %>% 
  summarise(dist_sem = sd(rev_dist)/sqrt(length(rev_dist)))
speed_SEM <- cleanrawsrev %>% 
  group_by(genotype, time) %>% 
  summarise(speed_sem = sd(rev_speed)/sqrt(length(rev_speed)))

```


```{r}
##Habituation plots 

mean_cleanrawsrev_filt <- mean_cleanrawsrev %>% 
  filter(genotype %in% c("OH13988N", "OH13988C"))
prob_SEM_filt <- prob_SEM %>% 
  filter(genotype %in% c("OH13988N", "OH13988C"))
ggplot(mean_cleanrawsrev_filt, aes(stimulus_num, rev_prob, colour = genotype)) +
  theme_classic() + 
  geom_line(size = 1) + 
  geom_errorbar(aes(ymin=rev_prob-prob_SEM_filt$prob_sem, ymax=rev_prob+prob_SEM_filt$prob_sem), width = 0, size = 1) +
  scale_y_continuous(expand = c(0,0),
                     limits = c(0,1.00)) +
  geom_point(aes(shape=genotype), size = 4.25, fill = "white", stroke = 1.25) +
  scale_shape_manual(values=c(16,16,16)) +
  scale_size_manual(values=c(4.25,4.25,4.25)) +
  scale_colour_manual(values = c("black", "dodgerblue2", "#EDBD44", "gray39")) +
  labs(title = "", x = "Stimulus number", y = "Reversal probability") +
  theme(axis.line = element_line(colour = 'black', size = 2.25)) +
  theme(axis.ticks = element_line(colour = "black", size = 2.25)) +
  theme(axis.ticks.length= unit(.25, "cm")) +
  theme(axis.text = element_text(family="Arial", colour = "black", size = 30)) +
  theme(axis.title.x = element_text(family="Arial", colour = "black", size = 30)) +
  theme(axis.title.y = element_text(family="Arial", colour = "black", size = 30)) +
  theme(legend.position="none") +
  theme(plot.title = element_text(face = "bold", hjust = 0.5)) 
  ggsave("unc3_3d_AID_C_prob.jpeg", width = 7, height = 6, path = "/Users/troymcdiarmid/Documents/Reversibility_materials/Figures/unc3/3d_recovery/habituation")
  
#Plot of duration habituation
  
mean_cleanrawsrev_filt <- mean_cleanrawsrev %>% 
  filter(genotype %in% c("OH13988N", "OH13988C"))
dur_SEM_filt <- dur_SEM %>% 
  filter(genotype %in% c("OH13988N", "OH13988C"))
ggplot(mean_cleanrawsrev_filt, aes(stimulus_num, rev_dur, colour = genotype)) + 
  geom_line(size = 1) +
  theme_classic() + 
  geom_errorbar(aes(ymin=rev_dur-dur_SEM_filt$dur_sem, ymax=rev_dur+dur_SEM_filt$dur_sem), width = 0, size = 1) +
  scale_y_continuous(expand = c(0,0),
                     limits = c(0,4)) +
  geom_point(aes(shape=genotype), size = 4.25, fill = "white", stroke = 1.25) +
  scale_shape_manual(values=c(16,16,16)) +
  scale_size_manual(values=c(4.25,4.25,4.25)) +
  scale_color_manual(values=c("black", "dodgerblue2", "#EDBD44", "gray39")) +
  labs(title = "", x = "Stimulus number", y = "Reversal duration (S)") +
  theme(axis.line = element_line(colour = 'black', size = 2.25)) +
  theme(axis.ticks = element_line(colour = "black", size = 2.25)) +
   theme(axis.ticks.length= unit(.25, "cm")) +
  theme(axis.text = element_text(family="Arial", colour = "black", size = 30)) +
  theme(axis.title.x = element_text(family="Arial", colour = "black", size = 30)) +
  theme(axis.title.y = element_text(family="Arial", colour = "black", size = 30)) +
  theme(plot.title = element_text(face = "bold", hjust = 0.5)) +
  theme(legend.position="none") +
  ggsave("unc3_3d_AID_C_dur.jpeg", width = 7, height = 6, path = "/Users/troymcdiarmid/Documents/Reversibility_materials/Figures/unc3/3d_recovery/habituation")

##Plot speed habituation

mean_cleanrawsrev_filt <- mean_cleanrawsrev %>% 
  filter(genotype %in% c("OH13988N", "OH13988C"))
speed_SEM_filt <- speed_SEM %>% 
  filter(genotype %in% c("OH13988N", "OH13988C"))
ggplot(mean_cleanrawsrev_filt, aes(stimulus_num, rev_speed, colour = genotype)) +
  geom_line(size = 1) +
  theme_classic() + 
  geom_errorbar(aes(ymin=rev_speed-speed_SEM_filt$speed_sem, ymax=rev_speed+speed_SEM_filt$speed_sem), width = 0, size = 1) +
  scale_y_continuous(expand = c(0,0),
                     limits = c(0,0.5)) +
  geom_point(aes(shape=genotype), size = 4.25, fill = "white", stroke = 1.25) +
  scale_shape_manual(values=c(16,16,16)) +
  scale_size_manual(values=c(4.25,4.25,4.25)) +
  scale_color_manual(values=c("black", "dodgerblue2", "gray39", "#EDBD44")) +
  labs(title = "", x = "Stimulus number", y = "Reversal speed (mm/s)") +
  theme(axis.line = element_line(colour = 'black', size = 2.25)) +
  theme(axis.ticks = element_line(colour = "black", size = 2.25)) +
   theme(axis.ticks.length= unit(.25, "cm")) +
  theme(axis.text = element_text(family="Arial", colour = "black", size = 30)) +
  theme(axis.title.x = element_text(family="Arial", colour = "black", size = 30)) +
  theme(axis.title.y = element_text(family="Arial", colour = "black", size = 30)) +
  theme(plot.title = element_text(face = "bold", hjust = 0.5)) +
  theme(legend.position="none") +
  ggsave("unc3_3d_AID_C_speed.jpeg", width = 7, height = 6, path = "/Users/troymcdiarmid/Documents/Reversibility_materials/Figures/unc3/3d_recovery/habituation")

##Habituation unc-3::AID::GFP continous degradation vs. non-treated and developmental degradtion/adult recovery

mean_cleanrawsrev_filt <- mean_cleanrawsrev %>% 
  filter(genotype %in% c("OH13988N", "OH13988C", "OH13988D"))
prob_SEM_filt <- prob_SEM %>% 
  filter(genotype %in% c("OH13988N", "OH13988C", "OH13988D"))
ggplot(mean_cleanrawsrev_filt, aes(stimulus_num, rev_prob, colour = genotype)) +
  theme_classic() + 
  geom_line(size = 1) + 
  geom_errorbar(aes(ymin=rev_prob-prob_SEM_filt$prob_sem, ymax=rev_prob+prob_SEM_filt$prob_sem), width = 0, size = 1) +
  scale_y_continuous(expand = c(0,0),
                     limits = c(0,1.00)) +
  geom_point(aes(shape=genotype), size = 4.25, fill = "white", stroke = 1.25) +
  scale_shape_manual(values=c(16,16,16)) +
  scale_size_manual(values=c(4.25,4.25,4.25)) +
  scale_colour_manual(values = c("black", "dodgerblue2", "gray39", "#EDBD44")) +
  labs(title = "", x = "Stimulus number", y = "Reversal probability") +
  theme(axis.line = element_line(colour = 'black', size = 2.25)) +
  theme(axis.ticks = element_line(colour = "black", size = 2.25)) +
  theme(axis.ticks.length= unit(.25, "cm")) +
  theme(axis.text = element_text(family="Arial", colour = "black", size = 30)) +
  theme(axis.title.x = element_text(family="Arial", colour = "black", size = 30)) +
  theme(axis.title.y = element_text(family="Arial", colour = "black", size = 30)) +
  theme(legend.position="none") +
  theme(plot.title = element_text(face = "bold", hjust = 0.5)) 
  ggsave("unc3_3d_AID_C_D_prob.jpeg", width = 7, height = 6, path = "/Users/troymcdiarmid/Documents/Reversibility_materials/Figures/unc3/3d_recovery/habituation")
  
#Plot of duration habituation
  
mean_cleanrawsrev_filt <- mean_cleanrawsrev %>% 
  filter(genotype %in% c("OH13988N", "OH13988C", "OH13988D"))
dur_SEM_filt <- dur_SEM %>% 
  filter(genotype %in% c("OH13988N", "OH13988C", "OH13988D"))
ggplot(mean_cleanrawsrev_filt, aes(stimulus_num, rev_dur, colour = genotype)) + 
  geom_line(size = 1) +
  theme_classic() + 
  geom_errorbar(aes(ymin=rev_dur-dur_SEM_filt$dur_sem, ymax=rev_dur+dur_SEM_filt$dur_sem), width = 0, size = 1) +
  scale_y_continuous(expand = c(0,0),
                     limits = c(0,4)) +
  geom_point(aes(shape=genotype), size = 4.25, fill = "white", stroke = 1.25) +
  scale_shape_manual(values=c(16,16,16)) +
  scale_size_manual(values=c(4.25,4.25,4.25)) +
  scale_color_manual(values=c("black", "dodgerblue2", "gray39", "#EDBD44")) +
  labs(title = "", x = "Stimulus number", y = "Reversal duration (S)") +
  theme(axis.line = element_line(colour = 'black', size = 2.25)) +
  theme(axis.ticks = element_line(colour = "black", size = 2.25)) +
   theme(axis.ticks.length= unit(.25, "cm")) +
  theme(axis.text = element_text(family="Arial", colour = "black", size = 30)) +
  theme(axis.title.x = element_text(family="Arial", colour = "black", size = 30)) +
  theme(axis.title.y = element_text(family="Arial", colour = "black", size = 30)) +
  theme(plot.title = element_text(face = "bold", hjust = 0.5)) +
  theme(legend.position="none") +
  ggsave("unc3_3d_AID_C_D_dur.jpeg", width = 7, height = 6, path = "/Users/troymcdiarmid/Documents/Reversibility_materials/Figures/unc3/3d_recovery/habituation")

##Plot speed habituation

mean_cleanrawsrev_filt <- mean_cleanrawsrev %>% 
  filter(genotype %in% c("OH13988N", "OH13988C", "OH13988D"))
speed_SEM_filt <- speed_SEM %>% 
  filter(genotype %in% c("OH13988N", "OH13988C", "OH13988D"))
ggplot(mean_cleanrawsrev_filt, aes(stimulus_num, rev_speed, colour = genotype)) +
  geom_line(size = 1) +
  theme_classic() + 
  geom_errorbar(aes(ymin=rev_speed-speed_SEM_filt$speed_sem, ymax=rev_speed+speed_SEM_filt$speed_sem), width = 0, size = 1) +
  scale_y_continuous(expand = c(0,0),
                     limits = c(0,0.5)) +
  geom_point(aes(shape=genotype), size = 4.25, fill = "white", stroke = 1.25) +
  scale_shape_manual(values=c(16,16,16)) +
  scale_size_manual(values=c(4.25,4.25,4.25)) +
  scale_color_manual(values=c("black", "dodgerblue2", "gray39", "#EDBD44")) +
  labs(title = "", x = "Stimulus number", y = "Reversal speed (mm/s)") +
  theme(axis.line = element_line(colour = 'black', size = 2.25)) +
  theme(axis.ticks = element_line(colour = "black", size = 2.25)) +
   theme(axis.ticks.length= unit(.25, "cm")) +
  theme(axis.text = element_text(family="Arial", colour = "black", size = 30)) +
  theme(axis.title.x = element_text(family="Arial", colour = "black", size = 30)) +
  theme(axis.title.y = element_text(family="Arial", colour = "black", size = 30)) +
  theme(plot.title = element_text(face = "bold", hjust = 0.5)) +
  theme(legend.position="none") +
  ggsave("unc3_3d_AID_C_D_speed.jpeg", width = 7, height = 6, path = "/Users/troymcdiarmid/Documents/Reversibility_materials/Figures/unc3/3d_recovery/habituation")

##Habituation unc-3::AID::GFP continous degradation vs. non-treated and adult inactivation

mean_cleanrawsrev_filt <- mean_cleanrawsrev %>% 
  filter(genotype %in% c("OH13988N", "OH13988C", "OH13988A"))
prob_SEM_filt <- prob_SEM %>% 
  filter(genotype %in% c("OH13988N", "OH13988C", "OH13988A"))
ggplot(mean_cleanrawsrev_filt, aes(stimulus_num, rev_prob, colour = genotype)) +
  theme_classic() + 
  geom_line(size = 1) + 
  geom_errorbar(aes(ymin=rev_prob-prob_SEM_filt$prob_sem, ymax=rev_prob+prob_SEM_filt$prob_sem), width = 0, size = 1) +
  scale_y_continuous(expand = c(0,0),
                     limits = c(0,1.00)) +
  geom_point(aes(shape=genotype), size = 4.25, fill = "white", stroke = 1.25) +
  scale_shape_manual(values=c(16,16,16)) +
  scale_size_manual(values=c(4.25,4.25,4.25)) +
  scale_colour_manual(values = c("black", "dodgerblue2", "#EDBD44", "gray39")) +
  labs(title = "", x = "Stimulus number", y = "Reversal probability") +
  theme(axis.line = element_line(colour = 'black', size = 2.25)) +
  theme(axis.ticks = element_line(colour = "black", size = 2.25)) +
  theme(axis.ticks.length= unit(.25, "cm")) +
  theme(axis.text = element_text(family="Arial", colour = "black", size = 30)) +
  theme(axis.title.x = element_text(family="Arial", colour = "black", size = 30)) +
  theme(axis.title.y = element_text(family="Arial", colour = "black", size = 30)) +
  theme(legend.position="none") +
  theme(plot.title = element_text(face = "bold", hjust = 0.5)) 
  ggsave("unc3_3d_AID_C_A_prob.jpeg", width = 7, height = 6, path = "/Users/troymcdiarmid/Documents/Reversibility_materials/Figures/unc3/3d_recovery/habituation")
  
#Plot of duration habituation
  
mean_cleanrawsrev_filt <- mean_cleanrawsrev %>% 
  filter(genotype %in% c("OH13988N", "OH13988C", "OH13988A"))
dur_SEM_filt <- dur_SEM %>% 
  filter(genotype %in% c("OH13988N", "OH13988C", "OH13988A"))
ggplot(mean_cleanrawsrev_filt, aes(stimulus_num, rev_dur, colour = genotype)) + 
  geom_line(size = 1) +
  theme_classic() + 
  geom_errorbar(aes(ymin=rev_dur-dur_SEM_filt$dur_sem, ymax=rev_dur+dur_SEM_filt$dur_sem), width = 0, size = 1) +
  scale_y_continuous(expand = c(0,0),
                     limits = c(0,4)) +
  geom_point(aes(shape=genotype), size = 4.25, fill = "white", stroke = 1.25) +
  scale_shape_manual(values=c(16,16,16)) +
  scale_size_manual(values=c(4.25,4.25,4.25)) +
  scale_color_manual(values=c("black", "dodgerblue2", "#EDBD44", "gray39")) +
  labs(title = "", x = "Stimulus number", y = "Reversal duration (S)") +
  theme(axis.line = element_line(colour = 'black', size = 2.25)) +
  theme(axis.ticks = element_line(colour = "black", size = 2.25)) +
   theme(axis.ticks.length= unit(.25, "cm")) +
  theme(axis.text = element_text(family="Arial", colour = "black", size = 30)) +
  theme(axis.title.x = element_text(family="Arial", colour = "black", size = 30)) +
  theme(axis.title.y = element_text(family="Arial", colour = "black", size = 30)) +
  theme(plot.title = element_text(face = "bold", hjust = 0.5)) +
  theme(legend.position="none") +
  ggsave("unc3_3d_AID_C_A_dur.jpeg", width = 7, height = 6, path = "/Users/troymcdiarmid/Documents/Reversibility_materials/Figures/unc3/3d_recovery/habituation")

##Plot speed habituation

mean_cleanrawsrev_filt <- mean_cleanrawsrev %>% 
  filter(genotype %in% c("OH13988N", "OH13988C", "OH13988A"))
speed_SEM_filt <- speed_SEM %>% 
  filter(genotype %in% c("OH13988N", "OH13988C", "OH13988A"))
ggplot(mean_cleanrawsrev_filt, aes(stimulus_num, rev_speed, colour = genotype)) +
  geom_line(size = 1) +
  theme_classic() + 
  geom_errorbar(aes(ymin=rev_speed-speed_SEM_filt$speed_sem, ymax=rev_speed+speed_SEM_filt$speed_sem), width = 0, size = 1) +
  scale_y_continuous(expand = c(0,0),
                     limits = c(0,0.5)) +
  geom_point(aes(shape=genotype), size = 4.25, fill = "white", stroke = 1.25) +
  scale_shape_manual(values=c(16,16,16)) +
  scale_size_manual(values=c(4.25,4.25,4.25)) +
  scale_color_manual(values=c("black", "dodgerblue2", "#EDBD44", "gray39")) +
  labs(title = "", x = "Stimulus number", y = "Reversal speed (mm/s)") +
  theme(axis.line = element_line(colour = 'black', size = 2.25)) +
  theme(axis.ticks = element_line(colour = "black", size = 2.25)) +
   theme(axis.ticks.length= unit(.25, "cm")) +
  theme(axis.text = element_text(family="Arial", colour = "black", size = 30)) +
  theme(axis.title.x = element_text(family="Arial", colour = "black", size = 30)) +
  theme(axis.title.y = element_text(family="Arial", colour = "black", size = 30)) +
  theme(plot.title = element_text(face = "bold", hjust = 0.5)) +
  theme(legend.position="none") +
  ggsave("unc3_3d_AID_C_A_speed.jpeg", width = 7, height = 6, path = "/Users/troymcdiarmid/Documents/Reversibility_materials/Figures/unc3/3d_recovery/habituation")

##Habituation unc-3::AID::GFP continous degradation vs. adult and developmental degradation

mean_cleanrawsrev_filt <- mean_cleanrawsrev %>% 
  filter(genotype %in% c("OH13988N", "OH13988C", "OH13988A", "OH13988D"))
prob_SEM_filt <- prob_SEM %>% 
  filter(genotype %in% c("OH13988N", "OH13988C", "OH13988A", "OH13988D"))
ggplot(mean_cleanrawsrev_filt, aes(stimulus_num, rev_prob, colour = genotype)) +
  theme_classic() + 
  geom_line(size = 1) + 
  geom_errorbar(aes(ymin=rev_prob-prob_SEM_filt$prob_sem, ymax=rev_prob+prob_SEM_filt$prob_sem), width = 0, size = 1) +
  scale_y_continuous(expand = c(0,0),
                     limits = c(0,1.00)) +
  geom_point(aes(shape=genotype), size = 4.25, fill = "white", stroke = 1.25) +
  scale_shape_manual(values=c(16,16,16,16)) +
  scale_size_manual(values=c(4.25,4.25,4.25,4.25)) +
  scale_colour_manual(values = c("black", "dodgerblue2", "#EDBD44", "gray39")) +
  labs(title = "", x = "Stimulus number", y = "Reversal probability") +
  theme(axis.line = element_line(colour = 'black', size = 2.25)) +
  theme(axis.ticks = element_line(colour = "black", size = 2.25)) +
  theme(axis.ticks.length= unit(.25, "cm")) +
  theme(axis.text = element_text(family="Arial", colour = "black", size = 30)) +
  theme(axis.title.x = element_text(family="Arial", colour = "black", size = 30)) +
  theme(axis.title.y = element_text(family="Arial", colour = "black", size = 30)) +
  theme(legend.position="none") +
  theme(plot.title = element_text(face = "bold", hjust = 0.5)) 
  ggsave("unc3_3d_AID_C_A_D_prob.jpeg", width = 7, height = 6, path = "/Users/troymcdiarmid/Documents/Reversibility_materials/Figures/unc3/3d_recovery/habituation")
  
#Plot of duration habituation
  
mean_cleanrawsrev_filt <- mean_cleanrawsrev %>% 
  filter(genotype %in% c("OH13988N", "OH13988C", "OH13988A", "OH13988D"))
dur_SEM_filt <- dur_SEM %>% 
  filter(genotype %in% c("OH13988N", "OH13988C", "OH13988A", "OH13988D"))
ggplot(mean_cleanrawsrev_filt, aes(stimulus_num, rev_dur, colour = genotype)) + 
  geom_line(size = 1) +
  theme_classic() + 
  geom_errorbar(aes(ymin=rev_dur-dur_SEM_filt$dur_sem, ymax=rev_dur+dur_SEM_filt$dur_sem), width = 0, size = 1) +
  scale_y_continuous(expand = c(0,0),
                     limits = c(0,4)) +
  geom_point(aes(shape=genotype), size = 4.25, fill = "white", stroke = 1.25) +
  scale_shape_manual(values=c(16,16,16,16)) +
  scale_size_manual(values=c(4.25,4.25,4.25,4.25)) +
  scale_color_manual(values=c("black", "dodgerblue2", "#EDBD44", "gray39")) +
  labs(title = "", x = "Stimulus number", y = "Reversal duration (S)") +
  theme(axis.line = element_line(colour = 'black', size = 2.25)) +
  theme(axis.ticks = element_line(colour = "black", size = 2.25)) +
   theme(axis.ticks.length= unit(.25, "cm")) +
  theme(axis.text = element_text(family="Arial", colour = "black", size = 30)) +
  theme(axis.title.x = element_text(family="Arial", colour = "black", size = 30)) +
  theme(axis.title.y = element_text(family="Arial", colour = "black", size = 30)) +
  theme(plot.title = element_text(face = "bold", hjust = 0.5)) +
  theme(legend.position="none") +
  ggsave("unc3_3d_AID_C_A_D_dur.jpeg", width = 7, height = 6, path = "/Users/troymcdiarmid/Documents/Reversibility_materials/Figures/unc3/3d_recovery/habituation")

##Plot speed habituation

mean_cleanrawsrev_filt <- mean_cleanrawsrev %>% 
  filter(genotype %in% c("OH13988N", "OH13988C", "OH13988A", "OH13988D"))
speed_SEM_filt <- speed_SEM %>% 
  filter(genotype %in% c("OH13988N", "OH13988C", "OH13988A", "OH13988D"))
ggplot(mean_cleanrawsrev_filt, aes(stimulus_num, rev_speed, colour = genotype)) +
  geom_line(size = 1) +
  theme_classic() + 
  geom_errorbar(aes(ymin=rev_speed-speed_SEM_filt$speed_sem, ymax=rev_speed+speed_SEM_filt$speed_sem), width = 0, size = 1) +
  scale_y_continuous(expand = c(0,0),
                     limits = c(0,0.5)) +
  geom_point(aes(shape=genotype), size = 4.25, fill = "white", stroke = 1.25) +
  scale_shape_manual(values=c(16,16,16,16)) +
  scale_size_manual(values=c(4.25,4.25,4.25,4.25)) +
  scale_color_manual(values=c("black", "dodgerblue2", "#EDBD44", "gray39")) +
  labs(title = "", x = "Stimulus number", y = "Reversal speed (mm/s)") +
  theme(axis.line = element_line(colour = 'black', size = 2.25)) +
  theme(axis.ticks = element_line(colour = "black", size = 2.25)) +
   theme(axis.ticks.length= unit(.25, "cm")) +
  theme(axis.text = element_text(family="Arial", colour = "black", size = 30)) +
  theme(axis.title.x = element_text(family="Arial", colour = "black", size = 30)) +
  theme(axis.title.y = element_text(family="Arial", colour = "black", size = 30)) +
  theme(plot.title = element_text(face = "bold", hjust = 0.5)) +
  theme(legend.position="none") +
  ggsave("unc3_3d_AID_C_A_D_speed.jpeg", width = 7, height = 6, path = "/Users/troymcdiarmid/Documents/Reversibility_materials/Figures/unc3/3d_recovery/habituation")

  
```


```{r}
##The following code creates a dataframe with all morphology and baseline locomotion measures throughout the tracking session.

##Comand to read .smorph file in 

setwd("/Volumes/SAMWISE/Troy/OH13988_AID_3DAY_0904_2020/data")

rawsmorph <- read_table2("data.smorph", col_names = c("plate_id", "width", "length", "morphwidth", "curve", "area", "midline", "pathlen", "bias", "dir", "angular", "aspect", "kink", "crab", "speed"))

cleanrawsmorph <- rawsmorph %>% 
  separate(plate_id, into = c("garbage", "plate_id", "genotype"), sep ="/") %>%
  separate(genotype, into = c("genotype", "time"), sep = ":") %>% separate(genotype, into = c("genotype", "synch_conditions", "growth_conditions"), sep = "_") 

####Make time numeric and round time

cleanrawsmorph <- cleanrawsmorph %>% mutate(time = as.numeric(time)) %>% 
  mutate(time = round(time, digits = 0)) 

##Ordering the genotype factor for plotting
    
cleanrawsmorph$genotype <- factor(cleanrawsmorph$genotype,
    levels = c('OH13988N', 'OH13988C', 'OH13988D', 'OH13988A', 'N2C', ordered = TRUE))

##Filtering to exclude first 10s when the tracker has yet to calculate conistent measurements for certain metrics.

cleanrawsmorph <- cleanrawsmorph %>% 
  filter(between(cleanrawsmorph$time, 10, 1199)) %>% 
  filter(!(genotype == 'N2C')) 

```


```{r}
##Code to calculate mean of morphology metrics

mean_cleanrawsmorph_whole_session <- cleanrawsmorph %>% 
  select(genotype, time, width:speed) 

mean_cleanrawsmorph_whole_session <- mean_cleanrawsmorph_whole_session %>%  
  group_by(genotype, time) %>%
  summarize_all(mean) 

ggplot(mean_cleanrawsmorph_whole_session, aes(time, speed, colour = genotype)) + 
geom_line(size = 0.3) +
   scale_colour_manual(values = c("black", "dodgerblue2", "gray39", "#EDBD44")) +
    scale_y_continuous(expand = c(0,0),
                     limits = c(0, 0.3), breaks = c(0,0.1,0.2,0.3)) +
  scale_x_continuous(expand = c(0,0),
                     limits = c(0, 1260), breaks = c(0,300,600,900,1200)) +
  theme_classic() +
  labs(y = "Speed (mm/s)", x = "Time (s)") +
  theme(legend.position = "none") +
  theme(axis.line.y = element_line(colour = 'black', size = 0.4)) + 
  theme(axis.line.x = element_line(colour = 'black', size = 0.4)) +
  theme(axis.ticks.y = element_line(colour = "black", size = 0.4)) +
  theme(axis.ticks.length=unit(.03, "in")) +
  theme(axis.text = element_text(family="Arial", colour = "black", size = 12)) +
  theme(axis.title = element_text(family="Arial", colour = "black", size = 12)) +
ggsave("unc3_rev_speed_trace_3d.jpeg", width = 3.5, height = 2.5, path = "/Users/troymcdiarmid/Documents/Reversibility_materials/Figures/unc3/3d_recovery/morphology/")


ggplot(mean_cleanrawsmorph_whole_session, aes(time, curve, colour = genotype)) + 
geom_line(size = 0.3) +
  scale_colour_manual(values = c("black", "dodgerblue2", "gray39", "#EDBD44")) +
    scale_y_continuous(expand = c(0,0),
                     limits = c(0, 40), breaks = c(0,10,20,30,40)) +
  scale_x_continuous(expand = c(0,0),
                     limits = c(0, 1260), breaks = c(0,300,600,900,1200)) +
  theme_classic() +
  labs(y = "Curvature (radians)", x = "Time (s)") +
  theme(legend.position = "none") +
  theme(axis.line.y = element_line(colour = 'black', size = 0.4)) + 
  theme(axis.line.x = element_line(colour = 'black', size = 0.4)) +
  theme(axis.ticks.y = element_line(colour = "black", size = 0.4)) +
  theme(axis.ticks.length=unit(.03, "in")) +
  theme(axis.text = element_text(family="Arial", colour = "black", size = 12)) +
  theme(axis.title = element_text(family="Arial", colour = "black", size = 12)) +
ggsave("unc3_rev_curve_trace_3d.jpeg", width = 3, height = 2.5, path = "/Users/troymcdiarmid/Documents/Reversibility_materials/Figures/unc3/3d_recovery/morphology/")

ggplot(mean_cleanrawsmorph_whole_session, aes(time, kink, colour = genotype)) + 
geom_line(size = 1) +
   scale_colour_manual(values = c("black", "dodgerblue2", "gray39", "#EDBD44")) +
    scale_y_continuous(expand = c(0,0),
                     limits = c(0,100), breaks = c(0,25,50,75,100)) +
  scale_x_continuous(expand = c(0,0),
                     limits = c(0, 1260), breaks = c(0,300,600,900,1200)) +
  theme_classic() +
  labs(y = "Kink (radians)", x = "Time (S)") +
  theme(legend.position = "none") +
  theme(axis.line = element_line(colour = 'black', size = 2.25)) +
  theme(axis.ticks = element_line(colour = "black", size = 2.25)) +
  theme(axis.ticks.length= unit(.25, "cm")) +
  theme(axis.text = element_text(family="Arial", colour = "black", size = 30)) +
  theme(axis.title.x = element_text(family="Arial", colour = "black", size = 30)) +
  theme(axis.title.y = element_text(family="Arial", colour = "black", size = 30)) +
  theme(plot.margin = margin(15, 15, 15, 15)) 
ggsave("unc3_rev_kink_trace_3d.jpeg", width = 7, height = 6, path = "/Users/troymcdiarmid/Documents/Reversibility_materials/Figures/unc3/3d_recovery/morphology/")

ggplot(mean_cleanrawsmorph_whole_session, aes(time, length, colour = genotype)) + 
geom_line(size = 1) +
   scale_colour_manual(values = c("black", "dodgerblue2", "gray39", "#EDBD44")) +
    scale_y_continuous(expand = c(0,0),
                     limits = c(0, 1.25), breaks = c(0,0.25,0.5,0.75,1.0,1.25)) +
  scale_x_continuous(expand = c(0,0),
                     limits = c(0, 1260), breaks = c(0,300,600,900,1200)) +
  theme_classic() +
  labs(y = "Length (mm)", x = "Time (s)") +
  theme(legend.position = "none") +
  theme(axis.line = element_line(colour = 'black', size = 2.25)) +
  theme(axis.ticks = element_line(colour = "black", size = 2.25)) +
  theme(axis.ticks.length= unit(.25, "cm")) +
  theme(axis.text = element_text(family="Arial", colour = "black", size = 30)) +
  theme(axis.title.x = element_text(family="Arial", colour = "black", size = 30)) +
  theme(axis.title.y = element_text(family="Arial", colour = "black", size = 30)) +
  theme(plot.margin = margin(15, 15, 15, 15))
ggsave("unc3_rev_Length_trace_3d.jpeg", width = 7, height = 6, path = "/Users/troymcdiarmid/Documents/Reversibility_materials/Figures/unc3/3d_recovery/morphology/")

ggplot(mean_cleanrawsmorph_whole_session, aes(time, midline, colour = genotype)) + 
geom_line(size = 0.3) +
   scale_colour_manual(values = c("black", "dodgerblue2", "gray39", "#EDBD44")) +
    scale_y_continuous(expand = c(0,0),
                     limits = c(0.0, 1.25), breaks = c(0.0,0.25,0.5,0.75,1.00,1.25)) +
  scale_x_continuous(expand = c(0,0),
                     limits = c(0, 1260), breaks = c(0,300,600,900,1200)) +
  theme_classic() +
  labs(y = "Midline length (mm)", x = "Time (s)") +
  theme(legend.position = "none") +
  theme(axis.line.y = element_line(colour = 'black', size = 0.4)) + 
  theme(axis.line.x = element_line(colour = 'black', size = 0.4)) +
  theme(axis.ticks.y = element_line(colour = "black", size = 0.4)) +
  theme(axis.ticks.length=unit(.03, "in")) +
  theme(axis.text = element_text(family="Arial", colour = "black", size = 12)) +
  theme(axis.title = element_text(family="Arial", colour = "black", size = 12)) +
ggsave("unc3_rev_midline_trace_3d.jpeg", width = 3, height = 2.5, path = "/Users/troymcdiarmid/Documents/Reversibility_materials/Figures/unc3/3d_recovery/morphology/")

ggplot(mean_cleanrawsmorph_whole_session, aes(time, width, colour = genotype)) + 
geom_line(size = 0.3) +
   scale_colour_manual(values = c("black", "dodgerblue2", "gray39", "#EDBD44")) +
    scale_y_continuous(expand = c(0,0),
                     limits = c(0, 0.4), breaks = c(0.0,0.1,0.2,0.3,0.4)) +
  scale_x_continuous(expand = c(0,0),
                     limits = c(0, 1260), breaks = c(0,300,600,900,1200)) +
  theme_classic() +
  labs(y = "Width (mm)", x = "Time (s)") +
  theme(legend.position = "none") +
  theme(axis.line.y = element_line(colour = 'black', size = 0.4)) + 
  theme(axis.line.x = element_line(colour = 'black', size = 0.4)) +
  theme(axis.ticks.y = element_line(colour = "black", size = 0.4)) +
  theme(axis.ticks.length=unit(.03, "in")) +
  theme(axis.text = element_text(family="Arial", colour = "black", size = 12)) +
  theme(axis.title = element_text(family="Arial", colour = "black", size = 12)) +
ggsave("unc3_rev_width_trace_3d.jpeg", width = 3, height = 2.5, path = "/Users/troymcdiarmid/Documents/Reversibility_materials/Figures/unc3/3d_recovery/morphology/")

ggplot(mean_cleanrawsmorph_whole_session, aes(time, pathlen, colour = genotype)) + 
geom_line(size = 0.3) +
   scale_colour_manual(values = c("black", "dodgerblue2", "gray39", "#EDBD44")) +
    scale_y_continuous(expand = c(0,0),
                     limits = c(0, 25), breaks = c(0,5,10,15,20,25)) +
  scale_x_continuous(expand = c(0,0),
                     limits = c(0, 1260), breaks = c(0,300,600,900,1200)) +
  theme_classic() +
  labs(y = "Pathlength (mm)", x = "Time (s)") +
  theme(legend.position = "none") +
  theme(axis.line.y = element_line(colour = 'black', size = 0.4)) + 
  theme(axis.line.x = element_line(colour = 'black', size = 0.4)) +
  theme(axis.ticks.y = element_line(colour = "black", size = 0.4)) +
  theme(axis.ticks.length=unit(.03, "in")) +
  theme(axis.text = element_text(family="Arial", colour = "black", size = 12)) +
  theme(axis.title = element_text(family="Arial", colour = "black", size = 12)) +
ggsave("unc3_rev_pathlength_trace_3d.jpeg", width = 3, height = 2.5, path = "/Users/troymcdiarmid/Documents/Reversibility_materials/Figures/unc3/3d_recovery/morphology/")

ggplot(mean_cleanrawsmorph_whole_session, aes(time, bias, colour = genotype)) + 
geom_line(size = 0.3) +
   scale_colour_manual(values = c("black", "dodgerblue2", "gray39", "#EDBD44")) +
    scale_y_continuous(expand = c(0,0),
                     limits = c(-1, 1), breaks = c(-1.0,-0.5,0,0.5,1.0)) +
  scale_x_continuous(expand = c(0,0),
                     limits = c(0, 1260), breaks = c(0,300,600,900,1200)) +
  theme_classic() +
  labs(y = "Direction bias", x = "Time (s)") +
  theme(legend.position = "none") +
  theme(axis.line.y = element_line(colour = 'black', size = 0.4)) + 
  theme(axis.line.x = element_line(colour = 'black', size = 0.4)) +
  theme(axis.ticks.y = element_line(colour = "black", size = 0.4)) +
  theme(axis.ticks.length=unit(.03, "in")) +
  theme(axis.text = element_text(family="Arial", colour = "black", size = 12)) +
  theme(axis.title = element_text(family="Arial", colour = "black", size = 12)) +
ggsave("unc3_rev_bias_trace_3d.jpeg", width = 3, height = 2.5, path = "/Users/troymcdiarmid/Documents/Reversibility_materials/Figures/unc3/3d_recovery/morphology/")

ggplot(mean_cleanrawsmorph_whole_session, aes(time, dir, colour = genotype)) + 
geom_line(size = 0.3) +
   scale_colour_manual(values = c("black", "dodgerblue2", "gray39", "#EDBD44")) +
    scale_y_continuous(expand = c(0,0),
                     limits = c(0, 0.06), breaks = c(0,0.02,0.04,0.06)) +
  scale_x_continuous(expand = c(0,0),
                     limits = c(0, 1260), breaks = c(0,300,600,900,1200)) +
  theme_classic() +
  labs(y = "Direction change", x = "Time (s)") +
  theme(legend.position = "none") +
  theme(axis.line.y = element_line(colour = 'black', size = 0.4)) + 
  theme(axis.line.x = element_line(colour = 'black', size = 0.4)) +
  theme(axis.ticks.y = element_line(colour = "black", size = 0.4)) +
  theme(axis.ticks.length=unit(.03, "in")) +
  theme(axis.text = element_text(family="Arial", colour = "black", size = 12)) +
  theme(axis.title = element_text(family="Arial", colour = "black", size = 12)) +
ggsave("unc3_rev_dir_trace_3d.jpeg", width = 3, height = 2.5, path = "/Users/troymcdiarmid/Documents/Reversibility_materials/Figures/unc3/3d_recovery/morphology/")

ggplot(mean_cleanrawsmorph_whole_session, aes(time, crab, colour = genotype)) + 
geom_line(size = 0.3) +
   scale_colour_manual(values = c("black", "dodgerblue2", "gray39", "#EDBD44")) +
    scale_y_continuous(expand = c(0,0),
                     limits = c(0, 0.06), breaks = c(0,0.02,0.04,0.06)) +
  scale_x_continuous(expand = c(0,0),
                     limits = c(0, 1260), breaks = c(0,300,600,900,1200)) +
  theme_classic() +
  labs(y = "Horizontal speed (mm/s)", x = "Time (s)") +
  theme(legend.position = "none") +
  theme(axis.line.y = element_line(colour = 'black', size = 0.4)) + 
  theme(axis.line.x = element_line(colour = 'black', size = 0.4)) +
  theme(axis.ticks.y = element_line(colour = "black", size = 0.4)) +
  theme(axis.ticks.length=unit(.03, "in")) +
  theme(axis.text = element_text(family="Arial", colour = "black", size = 12)) +
  theme(axis.title = element_text(family="Arial", colour = "black", size = 12)) +
ggsave("unc3_rev_crab_trace_3d.jpeg", width = 3, height = 2.5, path = "/Users/troymcdiarmid/Documents/Reversibility_materials/Figures/unc3/3d_recovery/morphology/")

ggplot(mean_cleanrawsmorph_whole_session, aes(time, aspect, colour = genotype)) + 
geom_line(size = 0.3) +
   scale_colour_manual(values = c("black", "dodgerblue2", "gray39", "#EDBD44")) +
    scale_y_continuous(expand = c(0,0),
                     limits = c(0.0, 0.6), breaks = c(0,0.2,0.4,0.6)) +
  scale_x_continuous(expand = c(0,0),
                     limits = c(0, 1260), breaks = c(0,300,600,900,1200)) +
  theme_classic() +
  labs(y = "Aspect (width to length ratio)", x = "Time (s)") +
  theme(legend.position = "none") +
  theme(axis.line.y = element_line(colour = 'black', size = 0.4)) + 
  theme(axis.line.x = element_line(colour = 'black', size = 0.4)) +
  theme(axis.ticks.y = element_line(colour = "black", size = 0.4)) +
  theme(axis.ticks.length=unit(.03, "in")) +
  theme(axis.text = element_text(family="Arial", colour = "black", size = 12)) +
  theme(axis.title = element_text(family="Arial", colour = "black", size = 12)) +
ggsave("unc3_rev_aspect_trace_3d.jpeg", width = 3, height = 2.5, path = "/Users/troymcdiarmid/Documents/Reversibility_materials/Figures/unc3/3d_recovery/morphology/")


ggplot(mean_cleanrawsmorph_whole_session, aes(time, angular, colour = genotype)) + 
geom_line(size = 0.3) +
   scale_colour_manual(values = c("black", "dodgerblue2", "gray39", "#EDBD44")) +
    scale_y_continuous(expand = c(0,0),
                     limits = c(0, 30), breaks = c(0,10,20,30)) +
  scale_x_continuous(expand = c(0,0),
                     limits = c(0, 1260), breaks = c(0,300,600,900,1200)) +
  theme_classic() +
  labs(y = "Angular speed (radians/second)", x = "Time (s)") +
  theme(legend.position = "none") +
  theme(axis.line.y = element_line(colour = 'black', size = 0.4)) + 
  theme(axis.line.x = element_line(colour = 'black', size = 0.4)) +
  theme(axis.ticks.y = element_line(colour = "black", size = 0.4)) +
  theme(axis.ticks.length=unit(.03, "in")) +
  theme(axis.text = element_text(family="Arial", colour = "black", size = 12)) +
  theme(axis.title = element_text(family="Arial", colour = "black", size = 12)) +
ggsave("unc3_rev_angular_trace_3d.jpeg", width = 3, height = 2.5, path = "/Users/troymcdiarmid/Documents/Reversibility_materials/Figures/unc3/3d_recovery/morphology/")


```


```{r}

##Maing midline length violin plot

##Getting just basline data

cleanrawsmorph_baseline <- cleanrawsmorph %>% 
  filter(between(cleanrawsmorph$time, 300, 599))


##Code to calculate mean of morphology metrics

mean_cleanrawsmorph <- cleanrawsmorph_baseline %>% 
  dplyr::select(genotype, plate_id, width:speed) 

mean_cleanrawsmorph <- mean_cleanrawsmorph %>%  
  group_by(genotype, plate_id) %>%
  summarize_all(mean) 

ggplot(mean_cleanrawsmorph, aes(genotype, midline, fill = genotype)) +
  geom_violin(position = position_dodge(width = 0.65), trim = FALSE, size = 0.4) +
  geom_point(position = position_jitterdodge(jitter.width = 0, jitter.height = 0.0,
  dodge.width = 0.65, seed = 3), size = 0.3) +
  scale_fill_manual(values = c("white", "dodgerblue2", "gray39", "#EDBD44")) +
  scale_y_continuous(expand = c(0,0),
                     limits = c(0.9,1.3), breaks = c(0.9,1.0,1.1,1.2,1.3)) +
  theme_classic() +
  labs(y = "Length (mm)", x = "") +
  theme(legend.title= element_text(family="Arial Bold")) +
  theme(legend.position = "none") +
  theme(axis.line = element_line(colour = 'black', size = 0.4)) + 
  theme(axis.ticks.y = element_line(colour = "black", size = 0.4)) +
  theme(axis.ticks.length=unit(.03, "in")) +
  theme(axis.ticks.x = element_line(size = 0)) +
  theme(axis.text = element_text(family="Arial", colour = "black")) +
  theme(axis.text.x = element_text(size = 0)) +
  theme(axis.text.y = element_text(family="Arial", colour = "black", size = 8)) +
  theme(axis.title.y = element_text(family="Arial", colour = "black", size = 8)) +
  theme(axis.title.x = element_text(family="Arial", colour = "black", size = 0)) +
ggsave("unc3_rev_midline_violin.jpeg", width = 2.7, height = 2.5, path = "/Users/troymcdiarmid/Desktop/")

summary(lm(midline~genotype, mean_cleanrawsmorph))


```

